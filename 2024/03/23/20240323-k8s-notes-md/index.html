<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>k8s 学习笔记 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="安装CentOS7123最小安装, 同时修改时区yum install net-tools psmisc -yhostnamectl set-hostname k8s01    Disable firewall12345[root@k8s01 ~]# systemctl stop firewalld[root@k8s01 ~]# systemctl disable firewalld [root@">
<meta property="og:type" content="article">
<meta property="og:title" content="k8s 学习笔记">
<meta property="og:url" content="http://example.com/2024/03/23/20240323-k8s-notes-md/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="安装CentOS7123最小安装, 同时修改时区yum install net-tools psmisc -yhostnamectl set-hostname k8s01    Disable firewall12345[root@k8s01 ~]# systemctl stop firewalld[root@k8s01 ~]# systemctl disable firewalld [root@">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-03-23T15:37:49.000Z">
<meta property="article:modified_time" content="2024-04-03T01:36:21.505Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="k8s">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-20240323-k8s-notes-md" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/23/20240323-k8s-notes-md/" class="article-date">
  <time class="dt-published" datetime="2024-03-23T15:37:49.000Z" itemprop="datePublished">2024-03-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      k8s 学习笔记
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="安装CentOS7"><a href="#安装CentOS7" class="headerlink" title="安装CentOS7"></a>安装CentOS7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">最小安装, 同时修改时区</span><br><span class="line">yum install net-tools psmisc -y</span><br><span class="line">hostnamectl set-hostname k8s01</span><br></pre></td></tr></table></figure>



<h3 id="Disable-firewall"><a href="#Disable-firewall" class="headerlink" title="Disable firewall"></a>Disable firewall</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># systemctl stop firewalld</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># systemctl disable firewalld </span></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># firewall-cmd  --state</span></span><br><span class="line">not running</span><br></pre></td></tr></table></figure>



<h3 id="Disable-selinux"><a href="#Disable-selinux" class="headerlink" title="Disable selinux"></a>Disable selinux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># sestatus</span></span><br><span class="line">SELinux status:                 enabled</span><br><span class="line">SELinuxfs mount:                /sys/fs/selinux</span><br><span class="line">SELinux root directory:         /etc/selinux</span><br><span class="line">Loaded policy name:             targeted</span><br><span class="line">Current mode:                   enforcing</span><br><span class="line">Mode from config file:          enforcing</span><br><span class="line">Policy MLS status:              enabled</span><br><span class="line">Policy deny_unknown status:     allowed</span><br><span class="line">Max kernel policy version:      31</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># getenforce</span></span><br><span class="line">Enforcing</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># sed -ri &#x27;s/SELINUX=enforcing/SELINUX=disabled/&#x27; /etc/selinux/config</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># sync</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># reboot</span></span><br><span class="line"></span><br><span class="line">[root@k8s03 ~]<span class="comment"># sestatus</span></span><br><span class="line">SELinux status:                 disabled</span><br><span class="line">[root@k8s03 ~]<span class="comment"># getenforce</span></span><br><span class="line">Disabled</span><br></pre></td></tr></table></figure>



<h3 id="同步时间"><a href="#同步时间" class="headerlink" title="同步时间"></a>同步时间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">timedatectl list-timezones</span><br><span class="line">timedatectl set-timezone  Asia/Shanghai</span><br><span class="line"></span><br><span class="line">yum install ntpdate -y</span><br><span class="line"></span><br><span class="line">crontab -e</span><br><span class="line">0 */1 * * * ntpdate time1.aliyun.com</span><br></pre></td></tr></table></figure>



<h3 id="Disable-swap"><a href="#Disable-swap" class="headerlink" title="Disable swap"></a>Disable swap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># free -m</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1837         149        1437           8         250        1544</span><br><span class="line">Swap:          2047           0        2047</span><br><span class="line">[root@k8s01 ~]<span class="comment"># vi /etc/fstab</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#/dev/mapper/centos-swap swap                    swap    defaults        0 0</span></span><br><span class="line">~</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># sync</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># reboot</span></span><br><span class="line"></span><br><span class="line">[root@k8s03 ~]<span class="comment"># free -m</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1837         155        1523           8         158        1536</span><br><span class="line">Swap:             0           0           0</span><br></pre></td></tr></table></figure>



<h3 id="添加网桥过滤及地址转发"><a href="#添加网桥过滤及地址转发" class="headerlink" title="添加网桥过滤及地址转发"></a>添加网桥过滤及地址转发</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># vi /etc/sysctl.d/k8s.conf</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">vm.swappiness = 0  </span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># modprobe br_netfilter</span></span><br><span class="line">                modprobe overlay</span><br><span class="line">[root@k8s01 ~]<span class="comment"># lsmod | grep br_netfilter</span></span><br><span class="line">br_netfilter           22256  0</span><br><span class="line">bridge                151336  1 br_netfilter</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># sysctl -p /etc/sysctl.d/k8s.conf</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">vm.swappiness = 0</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="开启ipvs"><a href="#开启ipvs" class="headerlink" title="开启ipvs"></a>开启ipvs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># yum -y install ipset ipvsadm  </span></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># cat &gt; /etc/sysconfig/modules/ipvs.modules&lt;&lt;EOF</span></span><br><span class="line">&gt; <span class="comment">#!/bin/bash</span></span><br><span class="line">&gt; modprobe -- ip_vs</span><br><span class="line">&gt; modprobe -- ip_vs_rr</span><br><span class="line">&gt; modprobe -- ip_vs_wrr</span><br><span class="line">&gt; modprobe -- ip_vs_sh</span><br><span class="line">&gt; modprobe -- nf_conntrack_ipv4</span><br><span class="line">&gt; EOF</span><br><span class="line">[root@k8s01 ~]<span class="comment"># vi /etc/sysconfig/modules/ipvs.modules</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod |grep -e ipvs -e nf_conntrack_ipv4</span></span><br><span class="line">nf_conntrack_ipv4      15053  0</span><br><span class="line">nf_defrag_ipv4         12729  1 nf_conntrack_ipv4</span><br><span class="line">nf_conntrack          139264  2 ip_vs,nf_conntrack_ipv4</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="Install-Docker-CE"><a href="#Install-Docker-CE" class="headerlink" title="Install Docker-CE"></a>Install Docker-CE</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># yum -y install wget</span></span><br><span class="line"></span><br><span class="line">wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># yum list docker-ce.x86_64 --showduplicates |sort -r </span></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># yum -y install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.el7 ^C</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># docker version</span></span><br><span class="line">Client:</span><br><span class="line"> Version:           18.06.3-ce</span><br><span class="line"> API version:       1.38</span><br><span class="line"> Go version:        go1.10.3</span><br><span class="line"> Git commit:        d7080c1</span><br><span class="line"> Built:             Wed Feb 20 02:26:51 2019</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br><span class="line">Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</span><br><span class="line">[root@k8s01 ~]<span class="comment"># systemctl enable docker</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line">[root@k8s01 ~]<span class="comment"># systemctl start docker</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># docker version</span></span><br><span class="line">Client:</span><br><span class="line"> Version:           18.06.3-ce</span><br><span class="line"> API version:       1.38</span><br><span class="line"> Go version:        go1.10.3</span><br><span class="line"> Git commit:        d7080c1</span><br><span class="line"> Built:             Wed Feb 20 02:26:51 2019</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          18.06.3-ce</span><br><span class="line">  API version:      1.38 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.10.3</span><br><span class="line">  Git commit:       d7080c1</span><br><span class="line">  Built:            Wed Feb 20 02:28:17 2019</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br></pre></td></tr></table></figure>



<h4 id="修改docker-ce服务配置文件"><a href="#修改docker-ce服务配置文件" class="headerlink" title="修改docker-ce服务配置文件"></a>修改docker-ce服务配置文件</h4><p>修改其目的是为了后续使用&#x2F;etc&#x2F;docker&#x2F;damon.json来进行更多的配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># cat /usr/lib/systemd/system/docker.service</span></span><br><span class="line">[Unit]</span><br><span class="line">...</span><br><span class="line">[Service]</span><br><span class="line">...</span><br><span class="line">ExecStart=/usr/bin/dockerd <span class="comment">#如果有-H, 请删除-H及后面的内容</span></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># vi /etc/docker/daemon.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123; <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">  <span class="string">&quot;http://74f21445.daocloud.io&quot;</span>,</span><br><span class="line">  <span class="string">&quot;https://registry.docker-cn.com&quot;</span>,</span><br><span class="line">  <span class="string">&quot;http://hub-mirror.c.163.com&quot;</span>,</span><br><span class="line">  <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;kubernetes-register.sswang.com&quot;</span>],</span><br><span class="line">  <span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@k8s03 ~]<span class="comment"># systemctl restart docker</span></span><br><span class="line">[root@k8s03 ~]<span class="comment"># systemctl status docker</span></span><br><span class="line">● docker.service - Docker Application Container Engine</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2024-03-23 23:30:36 CST; 1min 11s ago</span><br><span class="line">     Docs: https://docs.docker.com</span><br><span class="line"> Main PID: 8673 (dockerd)</span><br><span class="line">    Tasks: 22</span><br><span class="line">   Memory: 46.5M</span><br><span class="line">   CGroup: /system.slice/docker.service</span><br><span class="line">           ├─8673 /usr/bin/dockerd</span><br><span class="line">           └─8680 docker-containerd --config /var/run/docker/containerd/containerd.toml</span><br><span class="line"></span><br><span class="line">Mar 23 23:30:35 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:35.532222410+08:00&quot;</span> level=info msg=<span class="string">&quot;ClientConn switching balancer to \&quot;pick_first\&quot;&quot;</span> module=grpc</span><br><span class="line">Mar 23 23:30:35 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:35.532247767+08:00&quot;</span> level=info msg=<span class="string">&quot;pickfirstBalancer: HandleSubConnStateChange: 0xc420314580, CONNECTING&quot;</span> module=grpc</span><br><span class="line">Mar 23 23:30:35 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:35.532497409+08:00&quot;</span> level=info msg=<span class="string">&quot;pickfirstBalancer: HandleSubConnStateChange: 0xc420314580, READY&quot;</span> module=grpc</span><br><span class="line">Mar 23 23:30:35 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:35.532512142+08:00&quot;</span> level=info msg=<span class="string">&quot;Loading containers: start.&quot;</span></span><br><span class="line">Mar 23 23:30:35 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:35.864508051+08:00&quot;</span> level=info msg=<span class="string">&quot;Default bridge (docker0) is assigned with an IP address 172.17.0.0/16. Daemo... IP address&quot;</span></span><br><span class="line">Mar 23 23:30:35 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:35.996834139+08:00&quot;</span> level=info msg=<span class="string">&quot;Loading containers: done.&quot;</span></span><br><span class="line">Mar 23 23:30:36 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:36.043279489+08:00&quot;</span> level=info msg=<span class="string">&quot;Docker daemon&quot;</span> commit=d7080c1 graphdriver(s)=overlay2 version=18.06.3-ce</span><br><span class="line">Mar 23 23:30:36 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:36.043546250+08:00&quot;</span> level=info msg=<span class="string">&quot;Daemon has completed initialization&quot;</span></span><br><span class="line">Mar 23 23:30:36 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:36.065403547+08:00&quot;</span> level=info msg=<span class="string">&quot;API listen on /var/run/docker.sock&quot;</span></span><br><span class="line">Mar 23 23:30:36 k8s03 systemd[1]: Started Docker Application Container Engine.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br></pre></td></tr></table></figure>



<h3 id="安装k8s"><a href="#安装k8s" class="headerlink" title="安装k8s"></a>安装k8s</h3><ul>
<li><p>kubeadmin 初始化集群, 管理集群, 版本为1.17.2</p>
</li>
<li><p>kubelet 用于接收api-server指定, 对pod生命周期进行管理, 版本为1.17.2</p>
</li>
<li><p>kubectl 集群命令行管理工具, 版本为1.17.2</p>
</li>
<li><p>Docker-ce 版本为18.06.3</p>
<p><strong>google yum</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-e17-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://packages.cloud.google.com/yum/doc/yun-key.gpg         https://packages.cloud.google.com/yun/doc/rpm-package-key.gpg</span><br></pre></td></tr></table></figure>

<p><strong>ali yum</strong> (<a target="_blank" rel="noopener" href="https://developer.aliyun.com/mirror/kubernetes/">https://developer.aliyun.com/mirror/kubernetes/</a>)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-e17-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yun-key.gpg https://mirrors.aliyun.com/kubernetes/yun/doc/rpm-package-key.gpg</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line">setenforce 0</span><br><span class="line">yum install -y kubelet kubeadm kubectl</span><br><span class="line">systemctl enable kubelet &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure></li>
</ul>
<p>​       新版aliyun</p>
<pre><code>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">       cat &lt;&lt;EOF | tee /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">       [kubernetes]</span><br><span class="line">       name=Kubernetes</span><br><span class="line">       baseurl=https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.28/rpm/</span><br><span class="line">       enabled=1</span><br><span class="line">       gpgcheck=1</span><br><span class="line">       gpgkey=https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.28/rpm/repodata/repomd.xml.key</span><br><span class="line">       EOF</span><br><span class="line">       setenforce 0</span><br><span class="line">       yum install -y kubelet kubeadm kubectl</span><br><span class="line">       systemctl enable kubelet &amp;&amp; systemctl start kubelet</span><br><span class="line">       </span><br><span class="line">       # yum list kubelet.x86_64 --showduplicates |sort -r </span><br><span class="line">       yum list kubeadm.x86_64 --showduplicates |sort -r </span><br><span class="line">       yum list kubectl.x86_64 --showduplicates |sort -r </span><br><span class="line">       </span><br><span class="line">       # yum -y install --setopt=obsoletes=0 </span><br><span class="line">       yum -y install --setopt=obsoletes=0 kubeadm-1.17.2-0 kubectl-1.17.2-0 kubelet-1.17.2-0 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​       </span><br><span class="line">​       ```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​	**create repo file**</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">vi /etc/yum.repos.d/k8s.repo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]# yum list |grep kubeadm</span><br><span class="line">Importing GPG key 0x13EDEF05:</span><br><span class="line"> Userid     : &quot;Rapture Automatic Signing Key (cloud-rapture-signing-key-2022-03-07-08_01_01.pub)&quot;</span><br><span class="line"> Fingerprint: a362 b822 f6de dc65 2817 ea46 b53d c80d 13ed ef05</span><br><span class="line"> From       : https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">y</span><br></pre></td></tr></table></figure>
</code></pre>
<h3 id="kuber设置"><a href="#kuber设置" class="headerlink" title="kuber设置"></a>kuber设置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">为了实现docker使用的cgroupdriver与kublet使用的cgroup的一致性, 建议修改如下文件内容</span><br><span class="line">[root@k8s01 ~]<span class="comment"># vi /etc/sysconfig/kubelet</span></span><br><span class="line">KUBELET_EXTRA_ARGS=<span class="string">&quot;--cgroup-driver=systemd&quot;</span></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># systemctl enable kubelet</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/kubelet.service to /usr/lib/systemd/system/kubelet.service.</span><br></pre></td></tr></table></figure>



<h3 id="下载Master-Images"><a href="#下载Master-Images" class="headerlink" title="下载Master Images"></a>下载Master Images</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># kubeadm config images list</span></span><br><span class="line">I0324 00:24:14.972714    9050 version.go:256] remote version is much newer: v1.29.3; falling back to: stable-1.28</span><br><span class="line">registry.k8s.io/kube-apiserver:v1.28.8</span><br><span class="line">registry.k8s.io/kube-controller-manager:v1.28.8</span><br><span class="line">registry.k8s.io/kube-scheduler:v1.28.8</span><br><span class="line">registry.k8s.io/kube-proxy:v1.28.8</span><br><span class="line">registry.k8s.io/pause:3.9</span><br><span class="line">registry.k8s.io/etcd:3.5.9-0</span><br><span class="line">registry.k8s.io/coredns/coredns:v1.10.1</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># cat image.list</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">img_list=<span class="string">&#x27;registry.k8s.io/kube-apiserver:v1.28.8</span></span><br><span class="line"><span class="string">registry.k8s.io/kube-controller-manager:v1.28.8</span></span><br><span class="line"><span class="string">registry.k8s.io/kube-scheduler:v1.28.8</span></span><br><span class="line"><span class="string">registry.k8s.io/kube-proxy:v1.28.8</span></span><br><span class="line"><span class="string">registry.k8s.io/pause:3.9</span></span><br><span class="line"><span class="string">registry.k8s.io/etcd:3.5.9-0</span></span><br><span class="line"><span class="string">registry.k8s.io/coredns/coredns:v1.10.1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> img <span class="keyword">in</span> <span class="variable">$&#123;img_list&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">     docker pull <span class="variable">$img</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># sh image.list</span></span><br></pre></td></tr></table></figure>



<h4 id="dokcer-proxy设置"><a href="#dokcer-proxy设置" class="headerlink" title="dokcer proxy设置"></a>dokcer proxy设置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. 设置VM网络为NAT</span><br><span class="line">2. ip route show</span><br><span class="line">default via 10.0.2.2 dev enp0s3 proto dhcp metric 100</span><br><span class="line"></span><br><span class="line">3. mkdir /etc/systemd/system/docker.service.d</span><br><span class="line">   touch /etc/systemd/system/docker.service.d/http-proxy.conf</span><br><span class="line">   vi /etc/systemd/system/docker.service.d/http-proxy.conf</span><br><span class="line">   [Service]</span><br><span class="line">   Environment=&quot;HTTP_PROXY=http://10.0.2.2:7890&quot;</span><br><span class="line">   </span><br><span class="line"> 4. systemctl daemon-reload</span><br><span class="line"> 5. systemctl resetat docker</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/EahanZhang/article/details/77453396</span><br></pre></td></tr></table></figure>

<h4 id="work-node-image"><a href="#work-node-image" class="headerlink" title="work node image"></a>work node image</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY                                TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">registry.k8s.io/kube-apiserver            v1.28.8             e70a71eaa560        8 days ago          125MB</span><br><span class="line">registry.k8s.io/kube-proxy                v1.28.8             5ce97277076c        8 days ago          81.2MB</span><br><span class="line">registry.k8s.io/kube-controller-manager   v1.28.8             e5ae3e4dc656        8 days ago          121MB</span><br><span class="line">registry.k8s.io/kube-scheduler            v1.28.8             ad3260645145        8 days ago          59.3MB</span><br><span class="line">registry.k8s.io/etcd                      3.5.9-0             73deb9a3f702        10 months ago       294MB</span><br><span class="line">registry.k8s.io/coredns/coredns           v1.10.1             ead0a4a53df8        13 months ago       53.6MB</span><br><span class="line">registry.k8s.io/pause                     3.9                 e6f181688397        17 months ago       744kB</span><br><span class="line">[root@k8s01 ~]<span class="comment"># docker save -o kube-proxy.tar registry.k8s.io/kube-proxy:v1.28.8</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># docker save -o pause.tar registry.k8s.io/pause:3.9</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># ls</span></span><br><span class="line">anaconda-ks.cfg  a.txt  image.list  kube-proxy.tar  pause.tar</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># scp kube-proxy.tar pause.tar worker1:/root</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># scp kube-proxy.tar pause.tar worker2:/root</span></span><br><span class="line"></span><br><span class="line">[root@k8s02 ~]<span class="comment"># docker load -i kube-proxy.tar</span></span><br><span class="line">76412b93a631: Loading layer [==================================================&gt;]  28.27MB/28.27MB</span><br><span class="line">ccfa800cf862: Loading layer [==================================================&gt;]   54.2MB/54.2MB</span><br><span class="line">Loaded image: registry.k8s.io/kube-proxy:v1.28.8</span><br><span class="line">[root@k8s02 ~]<span class="comment"># docker load -i pause.tar</span></span><br><span class="line">e3e5579ddd43: Loading layer [==================================================&gt;]    746kB/746kB</span><br><span class="line">Loaded image: registry.k8s.io/pause:3.9</span><br><span class="line">[root@k8s02 ~]<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY                   TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">registry.k8s.io/kube-proxy   v1.28.8             5ce97277076c        8 days ago          81.2MB</span><br><span class="line">registry.k8s.io/pause        3.9                 e6f181688397        17 months ago       744kB</span><br></pre></td></tr></table></figure>



<h3 id="k8s集群初始化"><a href="#k8s集群初始化" class="headerlink" title="k8s集群初始化"></a>k8s集群初始化</h3><h5 id="master-node"><a href="#master-node" class="headerlink" title="master node"></a>master node</h5><p><a target="_blank" rel="noopener" href="https://github.com/flannel-io/flannel/blob/master/Documentation/kube-flannel.yml">https://github.com/flannel-io/flannel/blob/master/Documentation/kube-flannel.yml</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --kubernetes-version=v1.17.17 --pod-network-cidr=172.16.0.0/16 --apiserver-advertise-address=192.168.53.176</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># kubeadm init --kubernetes-version=v1.17.17 --pod-network-cidr=172.16.0.0/16 --apiserver-advertise-address=192.168.53.176</span></span><br><span class="line">W0324 19:53:57.423681   12767 validation.go:28] Cannot validate kubelet config - no validator is available</span><br><span class="line">W0324 19:53:57.423728   12767 validation.go:28] Cannot validate kube-proxy config - no validator is available</span><br><span class="line">[init] Using Kubernetes version: v1.17.17</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">[preflight] Pulling images required <span class="keyword">for</span> setting up a Kubernetes cluster</span><br><span class="line">[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">[preflight] You can also perform this action <span class="keyword">in</span> beforehand using <span class="string">&#x27;kubeadm config images pull&#x27;</span></span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file <span class="string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span></span><br><span class="line">[kubelet-start] Writing kubelet configuration to file <span class="string">&quot;/var/lib/kubelet/config.yaml&quot;</span></span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[certs] Using certificateDir folder <span class="string">&quot;/etc/kubernetes/pki&quot;</span></span><br><span class="line">[certs] Generating <span class="string">&quot;ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver&quot;</span> certificate and key</span><br><span class="line">[certs] apiserver serving cert is signed <span class="keyword">for</span> DNS names [k8s01 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.53.176]</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver-kubelet-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;front-proxy-ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;front-proxy-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/server&quot;</span> certificate and key</span><br><span class="line">[certs] etcd/server serving cert is signed <span class="keyword">for</span> DNS names [k8s01 localhost] and IPs [192.168.53.176 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/peer&quot;</span> certificate and key</span><br><span class="line">[certs] etcd/peer serving cert is signed <span class="keyword">for</span> DNS names [k8s01 localhost] and IPs [192.168.53.176 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/healthcheck-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver-etcd-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;sa&quot;</span> key and public key</span><br><span class="line">[kubeconfig] Using kubeconfig folder <span class="string">&quot;/etc/kubernetes&quot;</span></span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;admin.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;kubelet.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;controller-manager.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;scheduler.conf&quot;</span> kubeconfig file</span><br><span class="line">[control-plane] Using manifest folder <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-apiserver&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-controller-manager&quot;</span></span><br><span class="line">W0324 19:54:01.768946   12767 manifests.go:214] the default kube-apiserver authorization-mode is <span class="string">&quot;Node,RBAC&quot;</span>; using <span class="string">&quot;Node,RBAC&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-scheduler&quot;</span></span><br><span class="line">W0324 19:54:01.769535   12767 manifests.go:214] the default kube-apiserver authorization-mode is <span class="string">&quot;Node,RBAC&quot;</span>; using <span class="string">&quot;Node,RBAC&quot;</span></span><br><span class="line">[etcd] Creating static Pod manifest <span class="keyword">for</span> <span class="built_in">local</span> etcd <span class="keyword">in</span> <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[wait-control-plane] Waiting <span class="keyword">for</span> the kubelet to boot up the control plane as static Pods from directory <span class="string">&quot;/etc/kubernetes/manifests&quot;</span>. This can take up to 4m0s</span><br><span class="line">[kubelet-check] Initial <span class="built_in">timeout</span> of 40s passed.</span><br><span class="line">[apiclient] All control plane components are healthy after 48.559102 seconds</span><br><span class="line">[upload-config] Storing the configuration used <span class="keyword">in</span> ConfigMap <span class="string">&quot;kubeadm-config&quot;</span> <span class="keyword">in</span> the <span class="string">&quot;kube-system&quot;</span> Namespace</span><br><span class="line">[kubelet] Creating a ConfigMap <span class="string">&quot;kubelet-config-1.17&quot;</span> <span class="keyword">in</span> namespace kube-system with the configuration <span class="keyword">for</span> the kubelets <span class="keyword">in</span> the cluster</span><br><span class="line">[upload-certs] Skipping phase. Please see --upload-certs</span><br><span class="line">[mark-control-plane] Marking the node k8s01 as control-plane by adding the label <span class="string">&quot;node-role.kubernetes.io/master=&#x27;&#x27;&quot;</span></span><br><span class="line">[mark-control-plane] Marking the node k8s01 as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]</span><br><span class="line">[bootstrap-token] Using token: jtgwve.4boa5316axq8hamw</span><br><span class="line">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs <span class="keyword">in</span> order <span class="keyword">for</span> nodes to get long term certificate credentials</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow certificate rotation <span class="keyword">for</span> all node client certificates <span class="keyword">in</span> the cluster</span><br><span class="line">[bootstrap-token] Creating the <span class="string">&quot;cluster-info&quot;</span> ConfigMap <span class="keyword">in</span> the <span class="string">&quot;kube-public&quot;</span> namespace</span><br><span class="line">[kubelet-finalize] Updating <span class="string">&quot;/etc/kubernetes/kubelet.conf&quot;</span> to point to a rotatable kubelet client certificate and key</span><br><span class="line">[addons] Applied essential addon: CoreDNS</span><br><span class="line">[addons] Applied essential addon: kube-proxy</span><br><span class="line"></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can <span class="built_in">join</span> any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm <span class="built_in">join</span> 192.168.53.176:6443 --token jtgwve.4boa5316axq8hamw \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:7130d2790f82d437f15c4816289f1f9a3dc671486e291ad701fcab425eec1851</span><br><span class="line">[root@k8s01 ~]<span class="comment">#                                                        </span></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment">#  mkdir -p $HOME/.kube</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># chown $(id -u):$(id -g) $HOME/.kube/config</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># ll $HOME/.kube/config</span></span><br><span class="line">-rw------- 1 root root 5454 Mar 24 20:08 /root/.kube/config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubectl apply -f kube-flannel.yml</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># kubectl get nodes</span></span><br><span class="line">NAME    STATUS   ROLES    AGE     VERSION</span><br><span class="line">k8s01   Ready    master   7h21m   v1.17.2</span><br><span class="line">k8s02   Ready    &lt;none&gt;   4h3m    v1.17.2</span><br><span class="line">k8s03   Ready    &lt;none&gt;   4h3m    v1.17.2</span><br><span class="line">[root@k8s01 ~]<span class="comment"># kubectl get cs</span></span><br><span class="line">NAME                 STATUS    MESSAGE             ERROR</span><br><span class="line">etcd-0               Healthy   &#123;<span class="string">&quot;health&quot;</span>:<span class="string">&quot;true&quot;</span>&#125;</span><br><span class="line">controller-manager   Healthy   ok</span><br><span class="line">scheduler            Healthy   ok</span><br><span class="line">[root@k8s01 ~]<span class="comment"># kubectl cluster-info</span></span><br><span class="line">Kubernetes master is running at https://192.168.53.176:6443</span><br><span class="line">KubeDNS is running at https://192.168.53.176:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span><br><span class="line"></span><br><span class="line">To further debug and diagnose cluster problems, use <span class="string">&#x27;kubectl cluster-info dump&#x27;</span>.</span><br><span class="line">[root@k8s01 ~]<span class="comment"># kubectl get pods --namespace kube-system</span></span><br><span class="line">NAME                            READY   STATUS                  RESTARTS   AGE</span><br><span class="line">coredns-6955765f44-b2hg9        0/1     Pending                 0          3h21m</span><br><span class="line">coredns-6955765f44-fbpjw        0/1     Pending                 0          3h21m</span><br><span class="line">etcd-k8s01                      1/1     Running                 0          3h21m</span><br><span class="line">kube-apiserver-k8s01            1/1     Running                 0          3h21m</span><br><span class="line">kube-controller-manager-k8s01   1/1     Running                 0          3h21m</span><br><span class="line">kube-flannel-ds-amd64-2mxrx     0/1     Init:ImagePullBackOff   0          4m17s</span><br><span class="line">kube-flannel-ds-amd64-7pvs9     0/1     Init:ImagePullBackOff   0          4m28s</span><br><span class="line">kube-flannel-ds-amd64-qggg9     0/1     Init:ImagePullBackOff   0          5m49s</span><br><span class="line">kube-proxy-9pv9b                1/1     Running                 0          4m28s</span><br><span class="line">kube-proxy-ldjq2                1/1     Running                 0          4m17s</span><br><span class="line">kube-proxy-mv2rs                1/1     Running                 0          3h21m</span><br><span class="line">kube-scheduler-k8s01            1/1     Running                 0          3h21m</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># kubectl get pods --namespace kube-system</span></span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-6955765f44-b2hg9        1/1     Running   0          7h16m</span><br><span class="line">coredns-6955765f44-fbpjw        1/1     Running   0          7h16m</span><br><span class="line">etcd-k8s01                      1/1     Running   2          7h16m</span><br><span class="line">kube-apiserver-k8s01            1/1     Running   14         7h16m</span><br><span class="line">kube-controller-manager-k8s01   1/1     Running   3          7h16m</span><br><span class="line">kube-flannel-ds-amd64-4w5q8     1/1     Running   11         3h20m</span><br><span class="line">kube-flannel-ds-amd64-ch2qk     1/1     Running   0          3h20m</span><br><span class="line">kube-flannel-ds-amd64-hg79p     1/1     Running   0          3h20m</span><br><span class="line">kube-proxy-9pv9b                1/1     Running   1          3h59m</span><br><span class="line">kube-proxy-ldjq2                1/1     Running   1          3h59m</span><br><span class="line">kube-proxy-mv2rs                1/1     Running   1          7h16m</span><br><span class="line">kube-scheduler-k8s01            1/1     Running   4          7h16m</span><br></pre></td></tr></table></figure>



<h5 id="work-node"><a href="#work-node" class="headerlink" title="work node"></a>work node</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 192.168.53.176:6443 --token jtgwve.4boa5316axq8hamw     --discovery-token-ca-cert-hash sha256:7130d2790f82d437f15c4816289f1f9a3dc671486e291ad701fcab425eec1851             </span><br></pre></td></tr></table></figure>



<p>kubectl get namespace  </p>
<p>kubectl get ns</p>
<p>kubectl get pods</p>
<p>kubectl create namespace test</p>
<p>kubectl delete namespace test</p>
<p>cat 01-create-ns.yaml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: test01</span><br></pre></td></tr></table></figure>



<p>kubctl apply -f 01-create-ns.yaml</p>
<p>kubctl delete  -f 01-create-ns.yaml</p>
<p>kubectl get pods –namespace kube-system</p>
<p>kubectl get pods -n kube-system</p>
<p><strong>imagePullPolicy</strong>: Always &#x2F; Never &#x2F; IfNotPresent</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat 02-create-pod.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: pod1</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-pod</span><br><span class="line">    image: nginx:latest</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    ports:</span><br><span class="line">    - name: nginxport</span><br><span class="line">      containerPort: 80</span><br></pre></td></tr></table></figure>

<p>kubectl get pods -o wide</p>
<h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><table>
<thead>
<tr>
<th>Name</th>
<th>Usage</th>
</tr>
</thead>
<tbody><tr>
<td>Deployment</td>
<td>声明式更新控制器, 用于发布无状态应用</td>
</tr>
<tr>
<td>ReplicaSet</td>
<td>副本集控制器, 用于对Pod进行副本规模扩大或裁剪</td>
</tr>
<tr>
<td>StatefulSet</td>
<td>有状态副本集, 用于发布有状态应用</td>
</tr>
<tr>
<td>DaemonSet</td>
<td>在K8s集群每一个Node上运行一个副本, 用于发布监控或日志收集类等应用</td>
</tr>
<tr>
<td>Job</td>
<td>运行一次性作业任务</td>
</tr>
<tr>
<td>Cronjob</td>
<td>运行周期性作业任务</td>
</tr>
</tbody></table>
<p><strong>Deployment</strong>  </p>
<ul>
<li><p>具有上线部署, 滚动升级, 创建副本, 回滚到以前某一版本(成功&#x2F;稳定)等</p>
</li>
<li><p>Deployment包含ReplicaSet, 除非需要自定义升级功能或者根本不需要升级Pod, 否则还是建议使用Deployment还不是ReplicaSet</p>
</li>
</ul>
<p>kubectl run  nginx-app1 –image&#x3D;nginx:latest –image-pull-policy&#x3D;IfNotPresent –replicas&#x3D;2</p>
<p>Kubectl delete deployment.apps nginx-app1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 <span class="built_in">test</span>]<span class="comment">#  kubectl get deployment.apps</span></span><br><span class="line">NAME         READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-app3   2/2     2            2           135m</span><br><span class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</span><br><span class="line">[root@k8s01 <span class="built_in">test</span>]<span class="comment">#  kubectl get deployment</span></span><br><span class="line">NAME         READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-app3   2/2     2            2           135m</span><br><span class="line">[root@k8s01 <span class="built_in">test</span>]<span class="comment"># kubectl get replicaset</span></span><br><span class="line">NAME                   DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-app3-59d6dc58f   2         2         2       136m</span><br></pre></td></tr></table></figure>

<p>yaml文件创建</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cat 03-create-deployment-app.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-app2</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginxapp2-container</span><br><span class="line">        image: nginx:latest</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure>



<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><table>
<thead>
<tr>
<th>Type</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>ClusterIP</td>
<td>默认, 分配一个集群内部可以访问的虚拟IP</td>
</tr>
<tr>
<td>NodePort</td>
<td>在每个Node上分配一个端口作为一个外部访问入口</td>
</tr>
<tr>
<td>LoadBalancer</td>
<td>工作在特定的Cloud Provider上, 例如Google Cloud, AWS, OpenStack</td>
</tr>
<tr>
<td>ExternalName</td>
<td>表示把集群外部的服务引入到集群内部中来, 既实现了集群内部的Pod与集群外部的服务进行通信</td>
</tr>
</tbody></table>
<p>kubectl run nginx-app1 –image&#x3D;nginx:latest –image-pull-policy&#x3D;IfNotPresent –replicas&#x3D;1</p>
<p>kubectl expose deployment.apps nginx-app1 –type&#x3D;ClusterIP –target-port&#x3D;80 <strong>–port&#x3D;80</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># kubectl get endpoints</span></span><br><span class="line">NAME             ENDPOINTS                     AGE</span><br><span class="line">kubernetes       192.168.53.176:6443           12h</span><br><span class="line">nginx-app3-svc   172.16.1.3:80,172.16.2.3:80   163m</span><br><span class="line">[root@k8s01 ~]<span class="comment"># kubectl get svc</span></span><br><span class="line">NAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes       ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP   12h</span><br><span class="line">nginx-app3-svc   ClusterIP   10.101.203.25   &lt;none&gt;        80/TCP    164m</span><br><span class="line">[root@k8s01 ~]<span class="comment">#                                                             </span></span><br></pre></td></tr></table></figure>



<p>kubectl get service</p>
<p>kubectl get svc</p>
<p>kubectl get endpoints</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f 04-create-depolyment-nginx-app2-service.yaml</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-app3</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginxapp3</span><br><span class="line">        image: nginx:latest</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-app3-svc</span><br><span class="line">spec:</span><br><span class="line">  type: ClusterIP</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br><span class="line">  ports:</span><br><span class="line">  - protocol: TCP</span><br><span class="line">    port: 80</span><br><span class="line">    targetPort: 80</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br></pre></td></tr></table></figure>



<p>kubectl get pods</p>
<p>kubectl exec -it podName bash</p>
<p>[root@k8s01 ~]# kubectl exec -it nginx-app3-59d6dc58f-lc7wj bash </p>
<p>sed -ri ‘s&#x2F;nginx2.com&#x2F;nginx.com&#x2F;‘ index.html</p>
<h4 id="node-pod-service"><a href="#node-pod-service" class="headerlink" title="node pod service"></a>node pod service</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-app3</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx-app3</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx-app3</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        apps: nginx-app3</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginxapp3</span><br><span class="line">        image: nginx:latest</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-app3-svc</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br><span class="line">  ports:</span><br><span class="line">  - protocol: TCP</span><br><span class="line">    port: 80</span><br><span class="line">    targetPort: 80</span><br><span class="line">    nodePort: 30001 #30000-32767</span><br><span class="line">  selector:</span><br><span class="line">    apps: nginx-app3</span><br></pre></td></tr></table></figure>

<p>ss -anput |grep “:30001”</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/23/20240323-k8s-notes-md/" data-id="cluj864t10000ioo68qtgatoy" data-title="k8s 学习笔记" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2024/03/19/20240319-hexo-disply-image-md/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">解决Hexo 显示图片的问题</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9D%91/" rel="tag">坑</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/k8s/" style="font-size: 10px;">k8s</a> <a href="/tags/%E5%9D%91/" style="font-size: 20px;">坑</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/03/23/20240323-k8s-notes-md/">k8s 学习笔记</a>
          </li>
        
          <li>
            <a href="/2024/03/19/20240319-hexo-disply-image-md/">解决Hexo 显示图片的问题</a>
          </li>
        
          <li>
            <a href="/2024/03/19/20240319-pytest-learing-notes-md/">Pytest 学习笔记</a>
          </li>
        
          <li>
            <a href="/2024/03/14/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2024/03/11/Java-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Lambda/">Java 学习笔记--Lambda</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>