<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Jenkins-设置Git凭据的问题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/11/17/Jenkins-%E8%AE%BE%E7%BD%AEGit%E5%87%AD%E6%8D%AE%E7%9A%84%E9%97%AE%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2024-11-16T16:01:21.000Z" itemprop="datePublished">2024-11-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/11/17/Jenkins-%E8%AE%BE%E7%BD%AEGit%E5%87%AD%E6%8D%AE%E7%9A%84%E9%97%AE%E9%A2%98/">Jenkins 设置Git凭据的问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="设置步骤"><a href="#设置步骤" class="headerlink" title="设置步骤"></a>设置步骤</h2><p>进入凭据, 根据需要, 选择全局, 增加凭据</p>
<p><strong>类型</strong> -&gt; SSH Username with private key</p>
<p><strong>范围</strong>, 默认是全局</p>
<p><strong>ID</strong>, 起个名字, 唯一值,  不设置, 会自动生成一个uuid</p>
<p><strong>描述</strong>, 自行填写</p>
<p><em><strong><u>Username</u></strong></em> 这个要写github&#x2F;gitlab repo 上面的登录名</p>
<p>Private Key, 勾选</p>
<ul>
<li><p>Linux</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xclip -sel clip &lt; ~/.ssh/id_ed25519.pub</span><br></pre></td></tr></table></figure>
</li>
<li><p>Windows </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.ssh/id_ed25519.pub | clip</span><br></pre></td></tr></table></figure>
</li>
<li><p>Mac</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">方法1: tr -d &#x27;\n&#x27; &lt; ~/.ssh/id_ed25519.pub | pbcopy</span><br><span class="line"></span><br><span class="line">方法2: pbcopy &lt; id_ed25519</span><br></pre></td></tr></table></figure></li>
</ul>
<p><em><strong><u>Passphrase</u></strong></em></p>
<ul>
<li>输入Private key的密码</li>
</ul>
<h2 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h2><ol>
<li><p>stdout:  stderr: No ECDSA host key is known for gitlab.amcax.net and you have requested strict checking. Host key verification failed.</p>
</li>
<li><p>stderr: Permission denied, please try again.</p>
</li>
</ol>
<p>系统管理 -&gt; 全局安全设置 -&gt; Git Host Key Verification Configuration</p>
<p><strong>选择No verificatoin</strong>, 但这样安全性就很低</p>
<p><strong>如果选择Known host file</strong>, 需要用jenkins用户进拉docker 将远程repo的ssh信息手动加到known_host文件.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker <span class="built_in">exec</span> -it -u jenkins myjenkins bash</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /var/jenkins_home/</span><br><span class="line">$ <span class="built_in">mkdir</span> .ssh</span><br><span class="line">$ <span class="built_in">chmod</span> 700 .ssh</span><br><span class="line"> </span><br><span class="line">$ ssh-keyscan gitlab.com &gt;&gt; /var/jenkins_home/.ssh/known_hosts</span><br><span class="line">$ ssh-keyscan -t ed25519 github.com &gt;&gt; /var/jenkins_home/.ssh/known_hosts</span><br><span class="line"></span><br><span class="line">&gt; docker <span class="built_in">exec</span> -it -u root myjenkins bash</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">mkdir</span> /root/.ssh &amp;&amp; <span class="built_in">chmod</span> 700 /root/.ssh</span><br><span class="line">$ ssh-keyscan gitlab.com &gt;&gt; /root/.ssh/known_hosts</span><br><span class="line">$ ssh-keyscan -t ed25519 github.com &gt;&gt; /root/.ssh/known_hosts</span><br></pre></td></tr></table></figure>



<p><strong>选择Accept first connnection</strong>, 可以不用手动添加known_hosts, 但还是要手动创建.ssh目录和known_hosts文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /var/jenkins_home/.ssh</span><br><span class="line"><span class="built_in">chmod</span> 700 /var/jenkins_home/.ssh</span><br><span class="line"><span class="built_in">touch</span> /var/jenkins_home/.ssh/known_hosts</span><br><span class="line"><span class="built_in">chmod</span> 600 /var/jenkins_home/.ssh/known_hosts</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /root/.ssh</span><br><span class="line"><span class="built_in">chmod</span> 700 /root/.ssh</span><br><span class="line"><span class="built_in">touch</span> /root/.ssh/known_hosts</span><br><span class="line"><span class="built_in">chmod</span> 600 /root/.ssh/known_hosts</span><br></pre></td></tr></table></figure>

<h1 id="Jenkins-设置Git凭据的问题"><a href="#Jenkins-设置Git凭据的问题" class="headerlink" title="Jenkins 设置Git凭据的问题"></a>Jenkins 设置Git凭据的问题</h1><h2 id="设置步骤-1"><a href="#设置步骤-1" class="headerlink" title="设置步骤"></a>设置步骤</h2><p>进入凭据, 根据需要, 选择全局, 增加凭据</p>
<p><strong>类型</strong> -&gt; SSH Username with private key</p>
<p><strong>范围</strong>, 默认是全局</p>
<p><strong>ID</strong>, 起个名字, 唯一值,  不设置, 会自动生成一个uuid</p>
<p><strong>描述</strong>, 自行填写</p>
<p><em><strong><u>Username</u></strong></em> 这个要写github&#x2F;gitlab repo 上面的登录名</p>
<p>Private Key, 勾选</p>
<ul>
<li><p>Linux</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xclip -sel clip &lt; ~/.ssh/id_ed25519.pub</span><br></pre></td></tr></table></figure>
</li>
<li><p>Windows </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.ssh/id_ed25519.pub | clip</span><br></pre></td></tr></table></figure>
</li>
<li><p>Mac</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">方法1: tr -d &#x27;\n&#x27; &lt; ~/.ssh/id_ed25519.pub | pbcopy</span><br><span class="line"></span><br><span class="line">方法2: pbcopy &lt; id_ed25519</span><br></pre></td></tr></table></figure></li>
</ul>
<p><em><strong><u>Passphrase</u></strong></em></p>
<ul>
<li>输入Private key的密码</li>
</ul>
<h2 id="问题解决-1"><a href="#问题解决-1" class="headerlink" title="问题解决"></a>问题解决</h2><ol>
<li><p>stdout:  stderr: No ECDSA host key is known for gitlab.amcax.net and you have requested strict checking. Host key verification failed.</p>
</li>
<li><p>stderr: Permission denied, please try again.</p>
</li>
</ol>
<p>系统管理 -&gt; 全局安全设置 -&gt; Git Host Key Verification Configuration</p>
<p><strong>选择No verificatoin</strong>, 但这样安全性就很低</p>
<p><strong>如果选择Known host file</strong>, 需要用jenkins用户进拉docker 将远程repo的ssh信息手动加到known_host文件.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker <span class="built_in">exec</span> -it -u jenkins myjenkins bash</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /var/jenkins_home/</span><br><span class="line">$ <span class="built_in">mkdir</span> .ssh</span><br><span class="line">$ <span class="built_in">chmod</span> 700 .ssh</span><br><span class="line"> </span><br><span class="line">$ ssh-keyscan gitlab.com &gt;&gt; /var/jenkins_home/.ssh/known_hosts</span><br><span class="line">$ ssh-keyscan -t ed25519 github.com &gt;&gt; /var/jenkins_home/.ssh/known_hosts</span><br><span class="line"></span><br><span class="line">&gt; docker <span class="built_in">exec</span> -it -u root myjenkins bash</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">mkdir</span> /root/.ssh &amp;&amp; <span class="built_in">chmod</span> 700 /root/.ssh</span><br><span class="line">$ ssh-keyscan gitlab.com &gt;&gt; /root/.ssh/known_hosts</span><br><span class="line">$ ssh-keyscan -t ed25519 github.com &gt;&gt; /root/.ssh/known_hosts</span><br></pre></td></tr></table></figure>



<p><strong>选择Accept first connnection</strong>, 可以不用手动添加known_hosts, 但还是要手动创建.ssh目录和known_hosts文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /var/jenkins_home/.ssh</span><br><span class="line"><span class="built_in">chmod</span> 700 /var/jenkins_home/.ssh</span><br><span class="line"><span class="built_in">touch</span> /var/jenkins_home/.ssh/known_hosts</span><br><span class="line"><span class="built_in">chmod</span> 600 /var/jenkins_home/.ssh/known_hosts</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /root/.ssh</span><br><span class="line"><span class="built_in">chmod</span> 700 /root/.ssh</span><br><span class="line"><span class="built_in">touch</span> /root/.ssh/known_hosts</span><br><span class="line"><span class="built_in">chmod</span> 600 /root/.ssh/known_hosts</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/11/17/Jenkins-%E8%AE%BE%E7%BD%AEGit%E5%87%AD%E6%8D%AE%E7%9A%84%E9%97%AE%E9%A2%98/" data-id="cm3kcw0a80001ayqg1eac6leh" data-title="Jenkins 设置Git凭据的问题" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-迁移Docker-image-存储" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/11/16/%E8%BF%81%E7%A7%BBDocker-image-%E5%AD%98%E5%82%A8/" class="article-date">
  <time class="dt-published" datetime="2024-11-16T15:59:49.000Z" itemprop="datePublished">2024-11-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/11/16/%E8%BF%81%E7%A7%BBDocker-image-%E5%AD%98%E5%82%A8/">迁移Docker image 存储</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="Docker-image-存储位置"><a href="#Docker-image-存储位置" class="headerlink" title="Docker image 存储位置:"></a>Docker image 存储位置:</h3><p>%LOCALAPPDATA%\Docker\wsl</p>
<p>查看当前信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;wsl -l -v</span><br><span class="line">  NAME                   STATE           VERSION</span><br><span class="line">* docker-desktop-data    Stopped         2</span><br><span class="line">  docker-desktop         Stopped         2</span><br></pre></td></tr></table></figure>



<p>迁移</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\youka&gt;wsl --shutdown</span><br><span class="line"></span><br><span class="line">C:\Users\youka&gt;wsl --export docker-desktop-data h:\docker\docker-data.tar</span><br><span class="line">正在导出，这可能需要几分钟时间。</span><br><span class="line">操作成功完成。</span><br><span class="line"></span><br><span class="line">C:\Users\youka&gt;wsl --export docker-desktop-data h:\docker\docker-data.tar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Users\youka&gt;wsl --unregister docker-desktop-data</span><br><span class="line">正在注销。</span><br><span class="line">操作成功完成。</span><br><span class="line"></span><br><span class="line">C:\Users\youka&gt;wsl --import docker-desktop-data h:\docker\data h:\docker\docker-data.tar --version 2</span><br><span class="line">正在导入，这可能需要几分钟时间。</span><br><span class="line">操作成功完成。</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/11/16/%E8%BF%81%E7%A7%BBDocker-image-%E5%AD%98%E5%82%A8/" data-id="cm3kcw0a60000ayqg98gy2ekt" data-title="迁移Docker image 存储" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Jenkins-share-library-探坑" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/11/16/Jenkins-share-library-%E6%8E%A2%E5%9D%91/" class="article-date">
  <time class="dt-published" datetime="2024-11-16T15:52:52.000Z" itemprop="datePublished">2024-11-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/11/16/Jenkins-share-library-%E6%8E%A2%E5%9D%91/">Jenkins share library 探坑</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>因一个自动化测试项目, 运行在docker container中, Jenkins pipeline需要获取测试用例的运行结果, 来决定本次运行的最终结果.</p>
<p>一开始比较想当然的使用share library, 读取自动生成的Junit格式的xml, 然后使用Groovy内置的XmlParser来解析, 并分析得到是否有失败, 跳过的测试用例, 确认本次的运行结果</p>
<p>代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">src\</span><br><span class="line"></span><br><span class="line">class JunitReport</span><br><span class="line">   def xmlFile</span><br><span class="line">   </span><br><span class="line">   def read()&#123;</span><br><span class="line">        def xmlContents =  new File(this.xmlFile).text</span><br><span class="line">        def xml = new XmlSlurper().parseText(xmlContents)</span><br><span class="line">        //def xml = new XmlParser().parseText(xmlContents)</span><br><span class="line">      </span><br><span class="line">        def totalTests = 0</span><br><span class="line">        def totalErrors = 0</span><br><span class="line">        def totalFailures = 0</span><br><span class="line">        def totalSkipped = 0</span><br><span class="line"></span><br><span class="line">        xml.testsuite.each &#123; suite -&gt;</span><br><span class="line">            totalTests =+ suite.@tests.toInteger()</span><br><span class="line">            totalErrors += suite.@errors.toInteger()</span><br><span class="line">            totalFailures += suite.@failures.toInteger()</span><br><span class="line">            totalSkipped += suite.@skipped.toInteger()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return [</span><br><span class="line">                &#x27;test&#x27;: totalTests,</span><br><span class="line">                &#x27;error&#x27;: totalErrors,</span><br><span class="line">                &#x27;fail&#x27;: totalFailures,</span><br><span class="line">                &#x27;skip&#x27;: totalSkipped</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">vars\</span><br><span class="line"></span><br><span class="line">def call(xmlFile)&#123;</span><br><span class="line">    def junit = new JunitReport(xmlFile:xmlFiles)</span><br><span class="line">    def report = junit.read()</span><br><span class="line">    if (report.error &gt; 0 ||  report.skip &gt; 0 || report.fail &gt; 0)&#123;</span><br><span class="line">        return  false</span><br><span class="line">    &#125; else&#123;</span><br><span class="line">        return  true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>Jenkins 提示找不到XmlSlurper或XmlParser,  当时没有明白share library的Groovy的具体版本, 所以也就没有搞清楚4.X内置的库为什么找不到, 加上@Grab(“org.apache.groovy:groovy-xml:4.0.21”), 本错误可以解决, 但新的错误是找不到xml文件, 加了一打印信息, 明明文件是有的, 但就是找不到, 最后在share library里面加上下面的代码, 才发现Share library是运行是Master Node上的, 所以肯定找不到放在Slave agent上的数据文件.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    def read()&#123;</span><br><span class="line">        def resource = this.getClass().getResource(&#x27;/&#x27;)</span><br><span class="line">        def absolutePath = new File(resource.toURI()).getAbsolutePath()</span><br><span class="line">        def fullPath = new File(absolutePath, this.xmlFile).getAbsolutePath()</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">+ pwd</span><br><span class="line">/home/jenkins_home/workspace/task3</span><br><span class="line">[Pipeline] sh</span><br><span class="line">+ ls -l /home/jenkins_home/workspace/task3/report/junit.xml</span><br><span class="line">-rw-r--r--. 1 root root 7199 Jun 24 17:39 /home/jenkins_home/workspace/task3/report/junit.xml</span><br><span class="line"></span><br><span class="line">java.io.FileNotFoundException: /var/jenkins_home/war/WEB-INF/classes/report/junit.xml (No such file or directory)</span><br></pre></td></tr></table></figure>

<p>使用内置的Steps, readFile读取Slave上的文件, 然后会传递给share lib中的类处理, 但新的问题来了, 提示缺失了某个方法, 改动和错误如下 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">class JunitReport &#123;</span><br><span class="line">    String xmlContents</span><br><span class="line">    </span><br><span class="line">    def read()&#123;</span><br><span class="line">        //def xml = new XmlSlurper().parseText(xmlContents)</span><br><span class="line">        def xml = new XmlParser().parseText(xmlContents)</span><br><span class="line">        </span><br><span class="line">                </span><br><span class="line">//Jenkins pipeline stage                </span><br><span class="line">             script&#123;</span><br><span class="line">                        def xmlContents = readFile &#x27;report/junit.xml&#x27;</span><br><span class="line">                        def result = jReport(xmlContents)</span><br><span class="line">                        if (result) &#123;</span><br><span class="line">                            currentBuild.result = &#x27;SUCCESS&#x27;</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            currentBuild.result = &#x27;FAILURE&#x27;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                   &#125;</span><br><span class="line"></span><br><span class="line">Also:   org.jenkinsci.plugins.workflow.actions.ErrorAction$ErrorId: 20a2766a-af44-4a79-b059-ef52fe62307f</span><br><span class="line">java.lang.NoSuchMethodError: &#x27;void groovy.xml.XmlUtil.setFeatureQuietly(javax.xml.parsers.SAXParserFactory, java.lang.String, boolean)&#x27;</span><br><span class="line">	at groovy.xml.XmlParser.&lt;init&gt;(XmlParser.java:120)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>在share lib中打了一行打印版本的信息, 得到的结果是2.4.21</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new Logger().info(&quot;Groovy version: $&#123;GroovySystem.version&#125;&quot;)</span><br></pre></td></tr></table></figure>



<p>想改变Groovy的版本, 分别使用了内置的tool和docker image运行, 都不行, share lib的版本始终是2.x版本</p>
<pre><code>tools &#123;
    groovy &#39;groovy&#39;
&#125;

      stage(&#39;Prepare&#39;)&#123;
            steps&#123;

                sh &#39;env&#39;
                sh &#39;pwd&#39;
                sh &#39;ls -l /home/jenkins_home/workspace/task3/report/junit.xml&#39;
                //sh &#39;rm -rf *&#39;
                //sh &#39;ls -l&#39;
                sh &#39;groovy --version&#39;
                script&#123;
                    docker.image(&#39;groovy:4.0.20-jdk17&#39;).inside(&#39;-v $&#123;WORKSPACE&#125;:/share&#39;) &#123;
                        sh &#39;groovy --version&#39;
                        def xmlContents = readFile &#39;report/junit.xml&#39;
                        def result = jReport(xmlContents)
                        if (result) &#123;
                            currentBuild.result = &#39;SUCCESS&#39;
                        &#125; else &#123;
                            currentBuild.result = &#39;FAILURE&#39;
                        &#125;
                    &#125;
                &#125;
            &#125;
        &#125;

+ pwd
/home/jenkins_home/workspace/task3
[Pipeline] sh
+ ls -l /home/jenkins_home/workspace/task3/report/junit.xml
-rw-r--r--. 1 root root 7199 Jun 25 10:34 /home/jenkins_home/workspace/task3/report/junit.xml
[Pipeline] sh
+ groovy --version
Groovy Version: 4.0.21 JVM: 17.0.10 Vendor: Oracle Corporation OS: Linux
[Pipeline] script
[Pipeline] &#123;
[Pipeline] isUnix
[Pipeline] withEnv
[Pipeline] &#123;
[Pipeline] sh
+ docker inspect -f . groovy:4.0.20-jdk17
.
[Pipeline] &#125;
[Pipeline] // withEnv
[Pipeline] withDockerContainer
c2 does not seem to be running inside a container
$ docker run -t -d -u 0:0 -v $&#123;WORKSPACE&#125;:/share -w /home/jenkins_home/workspace/task3 -v /home/jenkins_home/workspace/task3:/home/jenkins_home/workspace/task3:rw,z -v /home/jenkins_home/workspace/task3@tmp:/home/jenkins_home/workspace/task3@tmp:rw,z -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** groovy:4.0.20-jdk17 cat
$ docker top d3acf25e36c816c6f8ef383abb30ee09c7835fc162ba36c031c8f79c493e85ca -eo pid,comm
[Pipeline] &#123;
[Pipeline] sh
+ groovy --version
WARNING: Using incubator modules: jdk.incubator.vector, jdk.incubator.foreign
Groovy Version: 4.0.20 JVM: 17.0.11 Vendor: Eclipse Adoptium OS: Linux
[Pipeline] readFile
[Pipeline] echo
[2024/06/25 11:12:03.212][INFO] Groovy version: 2.4.21
[Pipeline] &#125;
$ docker stop --time=1 d3acf25e36c816c6f8ef383abb30ee09c7835fc162ba36c031c8f79c493e85ca
$ docker rm -f --volumes d3acf25e36c816c6f8ef383abb30ee09c7835fc162ba36c031c8f79c493e85ca
</code></pre>
<p>最后, 只能使用Groovy 2.x版本的内置xml解析方法, 可以解决, 但因为4.0的版本, 相应的方法重构到groovy.xml包中, 所以在运行4.0的idea环境会标红报错, 不用管它, 直接提交.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Src\class</span><br><span class="line"></span><br><span class="line">class JunitReport &#123;</span><br><span class="line">    String xmlContents</span><br><span class="line"></span><br><span class="line">    def read()&#123;</span><br><span class="line">        new Logger().info(&quot;Groovy version: $&#123;GroovySystem.version&#125;&quot;)</span><br><span class="line">        def xml = new groovy.util.XmlParser().parseText(this.xmlContents)</span><br><span class="line"></span><br><span class="line">        def totalTests = 0</span><br><span class="line">        def totalErrors = 0</span><br><span class="line">        def totalFailures = 0</span><br><span class="line">        def totalSkipped = 0</span><br><span class="line"></span><br><span class="line">        xml.testsuite.each &#123; suite -&gt;</span><br><span class="line">            totalTests =+ suite.@tests.toInteger()</span><br><span class="line">            totalErrors += suite.@errors.toInteger()</span><br><span class="line">            totalFailures += suite.@failures.toInteger()</span><br><span class="line">            totalSkipped += suite.@skipped.toInteger()</span><br><span class="line">        &#125;</span><br><span class="line">        return [</span><br><span class="line">                &#x27;test&#x27;: totalTests,</span><br><span class="line">                &#x27;error&#x27;: totalErrors,</span><br><span class="line">                &#x27;fail&#x27;: totalFailures,</span><br><span class="line">                &#x27;skip&#x27;: totalSkipped</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><h3 id="Share-library-运行的结点"><a href="#Share-library-运行的结点" class="headerlink" title="Share library 运行的结点"></a>Share library 运行的结点</h3><p>运行在Master node, 如果有什么操作是对Slave上的数据, 尽量用Jenkins                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                内置的步骤</p>
<h3 id="Share-library-class-loader-目录"><a href="#Share-library-class-loader-目录" class="headerlink" title="Share library class loader 目录"></a>Share library class loader 目录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">master节点的/var/jenkins_home/war/WEB-INF/classes</span><br></pre></td></tr></table></figure>



<h3 id="Share-library-版本"><a href="#Share-library-版本" class="headerlink" title="Share library 版本"></a>Share library 版本</h3><p>Share library的Groovy版本为2.X, 不受docker和tool 指定版本的影响, 且不能改变, 无法升级.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Groovy version: 2.4.21</span><br></pre></td></tr></table></figure>



<h3 id="Share-library定义类"><a href="#Share-library定义类" class="headerlink" title="Share library定义类"></a>Share library定义类</h3><p>Share library中如果使用了类, 再使用Jenkins的内置Steps后, 会报错, 这些内置方法会被认为是类的方法, 但是又找不到实现, 解决方法, 是在Jenkins的Pipeline传递一个Steps的引用过来, 然后通过steps调用这些内置方法.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">stage(&quot;do somethings&quot;)</span><br><span class="line"> steps&#123;</span><br><span class="line">  script&#123;</span><br><span class="line">        deploy(this, &#x27;gitlab_testtoken&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vars\deploy.groovy</span><br><span class="line">def call(steps, apiToken)&#123;</span><br><span class="line">        new Gitlab(steps, apiToken).deploy()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">src\Gitlab.groovy</span><br><span class="line">class Gitlab&#123;</span><br><span class="line"></span><br><span class="line">Gitlab(steps, credentialsId)&#123;</span><br><span class="line">        this.steps = steps</span><br><span class="line">        this.credentialsId = credentialsId</span><br><span class="line">&#125;</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line"> def result = steps.readJSON text: &quot;&quot;&quot;$&#123;response.content&#125;&quot;&quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Share-library文件中只定义了方法"><a href="#Share-library文件中只定义了方法" class="headerlink" title="Share library文件中只定义了方法"></a>Share library文件中只定义了方法</h3><p>这种文件, 第一次用, 觉得很奇怪, 居然可以使用new 文件名, 实例化出来一个继承于Groovy.lang.script的子类, 可以能过实例直接调用其中的方法</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Jenkins的Share library是个天坑,  一方面提供了Groovy可以将常用的操作, 总结并共享出来, 但另一方面, 它的版本始终是2.x, 和现有的Groovy的开发环境不能保持一致, 所以能用内置Steps操作, 坚决使用内置操作</p>
<p>对于只使用Jenkins, 想了解的Groovy的人来说, 不必太过于深入, 知道基本的语法操作, 然后了解一下闭包和DSL就可以了.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/11/16/Jenkins-share-library-%E6%8E%A2%E5%9D%91/" data-id="cm3kcmiaq00003hqg5ijxfu60" data-title="Jenkins share library 探坑" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9D%91-Jenkins/" rel="tag">坑 Jenkins</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-20240323-k8s-notes-md" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/23/20240323-k8s-notes-md/" class="article-date">
  <time class="dt-published" datetime="2024-03-23T15:37:49.000Z" itemprop="datePublished">2024-03-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/23/20240323-k8s-notes-md/">k8s 学习笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="安装CentOS7"><a href="#安装CentOS7" class="headerlink" title="安装CentOS7"></a>安装CentOS7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">最小安装, 同时修改时区</span><br><span class="line">yum install net-tools psmisc -y</span><br><span class="line">hostnamectl set-hostname k8s01</span><br></pre></td></tr></table></figure>



<h3 id="Disable-firewall"><a href="#Disable-firewall" class="headerlink" title="Disable firewall"></a>Disable firewall</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># systemctl stop firewalld</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># systemctl disable firewalld </span></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># firewall-cmd  --state</span></span><br><span class="line">not running</span><br></pre></td></tr></table></figure>



<h3 id="Disable-selinux"><a href="#Disable-selinux" class="headerlink" title="Disable selinux"></a>Disable selinux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># sestatus</span></span><br><span class="line">SELinux status:                 enabled</span><br><span class="line">SELinuxfs mount:                /sys/fs/selinux</span><br><span class="line">SELinux root directory:         /etc/selinux</span><br><span class="line">Loaded policy name:             targeted</span><br><span class="line">Current mode:                   enforcing</span><br><span class="line">Mode from config file:          enforcing</span><br><span class="line">Policy MLS status:              enabled</span><br><span class="line">Policy deny_unknown status:     allowed</span><br><span class="line">Max kernel policy version:      31</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># getenforce</span></span><br><span class="line">Enforcing</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># sed -ri &#x27;s/SELINUX=enforcing/SELINUX=disabled/&#x27; /etc/selinux/config</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># sync</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># reboot</span></span><br><span class="line"></span><br><span class="line">[root@k8s03 ~]<span class="comment"># sestatus</span></span><br><span class="line">SELinux status:                 disabled</span><br><span class="line">[root@k8s03 ~]<span class="comment"># getenforce</span></span><br><span class="line">Disabled</span><br></pre></td></tr></table></figure>



<h3 id="同步时间"><a href="#同步时间" class="headerlink" title="同步时间"></a>同步时间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">timedatectl list-timezones</span><br><span class="line">timedatectl set-timezone  Asia/Shanghai</span><br><span class="line"></span><br><span class="line">yum install ntpdate -y</span><br><span class="line"></span><br><span class="line">crontab -e</span><br><span class="line">0 */1 * * * ntpdate time1.aliyun.com</span><br></pre></td></tr></table></figure>



<h3 id="Disable-swap"><a href="#Disable-swap" class="headerlink" title="Disable swap"></a>Disable swap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># free -m</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1837         149        1437           8         250        1544</span><br><span class="line">Swap:          2047           0        2047</span><br><span class="line">[root@k8s01 ~]<span class="comment"># vi /etc/fstab</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#/dev/mapper/centos-swap swap                    swap    defaults        0 0</span></span><br><span class="line">~</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># sync</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># reboot</span></span><br><span class="line"></span><br><span class="line">[root@k8s03 ~]<span class="comment"># free -m</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1837         155        1523           8         158        1536</span><br><span class="line">Swap:             0           0           0</span><br></pre></td></tr></table></figure>



<h3 id="添加网桥过滤及地址转发"><a href="#添加网桥过滤及地址转发" class="headerlink" title="添加网桥过滤及地址转发"></a>添加网桥过滤及地址转发</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># vi /etc/sysctl.d/k8s.conf</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">vm.swappiness = 0  </span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># modprobe br_netfilter</span></span><br><span class="line">                modprobe overlay</span><br><span class="line">[root@k8s01 ~]<span class="comment"># lsmod | grep br_netfilter</span></span><br><span class="line">br_netfilter           22256  0</span><br><span class="line">bridge                151336  1 br_netfilter</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># sysctl -p /etc/sysctl.d/k8s.conf</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">vm.swappiness = 0</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="开启ipvs"><a href="#开启ipvs" class="headerlink" title="开启ipvs"></a>开启ipvs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># yum -y install ipset ipvsadm  </span></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># cat &gt; /etc/sysconfig/modules/ipvs.modules&lt;&lt;EOF</span></span><br><span class="line">&gt; <span class="comment">#!/bin/bash</span></span><br><span class="line">&gt; modprobe -- ip_vs</span><br><span class="line">&gt; modprobe -- ip_vs_rr</span><br><span class="line">&gt; modprobe -- ip_vs_wrr</span><br><span class="line">&gt; modprobe -- ip_vs_sh</span><br><span class="line">&gt; modprobe -- nf_conntrack_ipv4</span><br><span class="line">&gt; EOF</span><br><span class="line">[root@k8s01 ~]<span class="comment"># vi /etc/sysconfig/modules/ipvs.modules</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod |grep -e ipvs -e nf_conntrack_ipv4</span></span><br><span class="line">nf_conntrack_ipv4      15053  0</span><br><span class="line">nf_defrag_ipv4         12729  1 nf_conntrack_ipv4</span><br><span class="line">nf_conntrack          139264  2 ip_vs,nf_conntrack_ipv4</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="Install-Docker-CE"><a href="#Install-Docker-CE" class="headerlink" title="Install Docker-CE"></a>Install Docker-CE</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># yum -y install wget</span></span><br><span class="line"></span><br><span class="line">wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># yum list docker-ce.x86_64 --showduplicates |sort -r </span></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># yum -y install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.el7 ^C</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># docker version</span></span><br><span class="line">Client:</span><br><span class="line"> Version:           18.06.3-ce</span><br><span class="line"> API version:       1.38</span><br><span class="line"> Go version:        go1.10.3</span><br><span class="line"> Git commit:        d7080c1</span><br><span class="line"> Built:             Wed Feb 20 02:26:51 2019</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br><span class="line">Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</span><br><span class="line">[root@k8s01 ~]<span class="comment"># systemctl enable docker</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line">[root@k8s01 ~]<span class="comment"># systemctl start docker</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># docker version</span></span><br><span class="line">Client:</span><br><span class="line"> Version:           18.06.3-ce</span><br><span class="line"> API version:       1.38</span><br><span class="line"> Go version:        go1.10.3</span><br><span class="line"> Git commit:        d7080c1</span><br><span class="line"> Built:             Wed Feb 20 02:26:51 2019</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          18.06.3-ce</span><br><span class="line">  API version:      1.38 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.10.3</span><br><span class="line">  Git commit:       d7080c1</span><br><span class="line">  Built:            Wed Feb 20 02:28:17 2019</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br></pre></td></tr></table></figure>



<h4 id="修改docker-ce服务配置文件"><a href="#修改docker-ce服务配置文件" class="headerlink" title="修改docker-ce服务配置文件"></a>修改docker-ce服务配置文件</h4><p>修改其目的是为了后续使用&#x2F;etc&#x2F;docker&#x2F;damon.json来进行更多的配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># cat /usr/lib/systemd/system/docker.service</span></span><br><span class="line">[Unit]</span><br><span class="line">...</span><br><span class="line">[Service]</span><br><span class="line">...</span><br><span class="line">ExecStart=/usr/bin/dockerd <span class="comment">#如果有-H, 请删除-H及后面的内容</span></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># vi /etc/docker/daemon.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123; <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">  <span class="string">&quot;http://74f21445.daocloud.io&quot;</span>,</span><br><span class="line">  <span class="string">&quot;https://registry.docker-cn.com&quot;</span>,</span><br><span class="line">  <span class="string">&quot;http://hub-mirror.c.163.com&quot;</span>,</span><br><span class="line">  <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;kubernetes-register.sswang.com&quot;</span>],</span><br><span class="line">  <span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@k8s03 ~]<span class="comment"># systemctl restart docker</span></span><br><span class="line">[root@k8s03 ~]<span class="comment"># systemctl status docker</span></span><br><span class="line">● docker.service - Docker Application Container Engine</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2024-03-23 23:30:36 CST; 1min 11s ago</span><br><span class="line">     Docs: https://docs.docker.com</span><br><span class="line"> Main PID: 8673 (dockerd)</span><br><span class="line">    Tasks: 22</span><br><span class="line">   Memory: 46.5M</span><br><span class="line">   CGroup: /system.slice/docker.service</span><br><span class="line">           ├─8673 /usr/bin/dockerd</span><br><span class="line">           └─8680 docker-containerd --config /var/run/docker/containerd/containerd.toml</span><br><span class="line"></span><br><span class="line">Mar 23 23:30:35 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:35.532222410+08:00&quot;</span> level=info msg=<span class="string">&quot;ClientConn switching balancer to \&quot;pick_first\&quot;&quot;</span> module=grpc</span><br><span class="line">Mar 23 23:30:35 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:35.532247767+08:00&quot;</span> level=info msg=<span class="string">&quot;pickfirstBalancer: HandleSubConnStateChange: 0xc420314580, CONNECTING&quot;</span> module=grpc</span><br><span class="line">Mar 23 23:30:35 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:35.532497409+08:00&quot;</span> level=info msg=<span class="string">&quot;pickfirstBalancer: HandleSubConnStateChange: 0xc420314580, READY&quot;</span> module=grpc</span><br><span class="line">Mar 23 23:30:35 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:35.532512142+08:00&quot;</span> level=info msg=<span class="string">&quot;Loading containers: start.&quot;</span></span><br><span class="line">Mar 23 23:30:35 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:35.864508051+08:00&quot;</span> level=info msg=<span class="string">&quot;Default bridge (docker0) is assigned with an IP address 172.17.0.0/16. Daemo... IP address&quot;</span></span><br><span class="line">Mar 23 23:30:35 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:35.996834139+08:00&quot;</span> level=info msg=<span class="string">&quot;Loading containers: done.&quot;</span></span><br><span class="line">Mar 23 23:30:36 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:36.043279489+08:00&quot;</span> level=info msg=<span class="string">&quot;Docker daemon&quot;</span> commit=d7080c1 graphdriver(s)=overlay2 version=18.06.3-ce</span><br><span class="line">Mar 23 23:30:36 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:36.043546250+08:00&quot;</span> level=info msg=<span class="string">&quot;Daemon has completed initialization&quot;</span></span><br><span class="line">Mar 23 23:30:36 k8s03 dockerd[8673]: time=<span class="string">&quot;2024-03-23T23:30:36.065403547+08:00&quot;</span> level=info msg=<span class="string">&quot;API listen on /var/run/docker.sock&quot;</span></span><br><span class="line">Mar 23 23:30:36 k8s03 systemd[1]: Started Docker Application Container Engine.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br></pre></td></tr></table></figure>



<h3 id="安装k8s"><a href="#安装k8s" class="headerlink" title="安装k8s"></a>安装k8s</h3><ul>
<li><p>kubeadmin 初始化集群, 管理集群, 版本为1.17.2</p>
</li>
<li><p>kubelet 用于接收api-server指定, 对pod生命周期进行管理, 版本为1.17.2</p>
</li>
<li><p>kubectl 集群命令行管理工具, 版本为1.17.2</p>
</li>
<li><p>Docker-ce 版本为18.06.3</p>
<p><strong>google yum</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-e17-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://packages.cloud.google.com/yum/doc/yun-key.gpg         https://packages.cloud.google.com/yun/doc/rpm-package-key.gpg</span><br></pre></td></tr></table></figure>

<p><strong>ali yum</strong> (<a target="_blank" rel="noopener" href="https://developer.aliyun.com/mirror/kubernetes/">https://developer.aliyun.com/mirror/kubernetes/</a>)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-e17-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yun-key.gpg https://mirrors.aliyun.com/kubernetes/yun/doc/rpm-package-key.gpg</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line">setenforce 0</span><br><span class="line">yum install -y kubelet kubeadm kubectl</span><br><span class="line">systemctl enable kubelet &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure></li>
</ul>
<p>​       新版aliyun</p>
<pre><code>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">       cat &lt;&lt;EOF | tee /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">       [kubernetes]</span><br><span class="line">       name=Kubernetes</span><br><span class="line">       baseurl=https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.28/rpm/</span><br><span class="line">       enabled=1</span><br><span class="line">       gpgcheck=1</span><br><span class="line">       gpgkey=https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.28/rpm/repodata/repomd.xml.key</span><br><span class="line">       EOF</span><br><span class="line">       setenforce 0</span><br><span class="line">       yum install -y kubelet kubeadm kubectl</span><br><span class="line">       systemctl enable kubelet &amp;&amp; systemctl start kubelet</span><br><span class="line">       </span><br><span class="line">       # yum list kubelet.x86_64 --showduplicates |sort -r </span><br><span class="line">       yum list kubeadm.x86_64 --showduplicates |sort -r </span><br><span class="line">       yum list kubectl.x86_64 --showduplicates |sort -r </span><br><span class="line">       </span><br><span class="line">       # yum -y install --setopt=obsoletes=0 </span><br><span class="line">       yum -y install --setopt=obsoletes=0 kubeadm-1.17.2-0 kubectl-1.17.2-0 kubelet-1.17.2-0 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​       </span><br><span class="line">​       ```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​	**create repo file**</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">vi /etc/yum.repos.d/k8s.repo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]# yum list |grep kubeadm</span><br><span class="line">Importing GPG key 0x13EDEF05:</span><br><span class="line"> Userid     : &quot;Rapture Automatic Signing Key (cloud-rapture-signing-key-2022-03-07-08_01_01.pub)&quot;</span><br><span class="line"> Fingerprint: a362 b822 f6de dc65 2817 ea46 b53d c80d 13ed ef05</span><br><span class="line"> From       : https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">y</span><br></pre></td></tr></table></figure>
</code></pre>
<h3 id="kuber设置"><a href="#kuber设置" class="headerlink" title="kuber设置"></a>kuber设置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">为了实现docker使用的cgroupdriver与kublet使用的cgroup的一致性, 建议修改如下文件内容</span><br><span class="line">[root@k8s01 ~]<span class="comment"># vi /etc/sysconfig/kubelet</span></span><br><span class="line">KUBELET_EXTRA_ARGS=<span class="string">&quot;--cgroup-driver=systemd&quot;</span></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># systemctl enable kubelet</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/kubelet.service to /usr/lib/systemd/system/kubelet.service.</span><br></pre></td></tr></table></figure>



<h3 id="下载Master-Images"><a href="#下载Master-Images" class="headerlink" title="下载Master Images"></a>下载Master Images</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># kubeadm config images list</span></span><br><span class="line">I0324 00:24:14.972714    9050 version.go:256] remote version is much newer: v1.29.3; falling back to: stable-1.28</span><br><span class="line">registry.k8s.io/kube-apiserver:v1.28.8</span><br><span class="line">registry.k8s.io/kube-controller-manager:v1.28.8</span><br><span class="line">registry.k8s.io/kube-scheduler:v1.28.8</span><br><span class="line">registry.k8s.io/kube-proxy:v1.28.8</span><br><span class="line">registry.k8s.io/pause:3.9</span><br><span class="line">registry.k8s.io/etcd:3.5.9-0</span><br><span class="line">registry.k8s.io/coredns/coredns:v1.10.1</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># cat image.list</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">img_list=<span class="string">&#x27;registry.k8s.io/kube-apiserver:v1.28.8</span></span><br><span class="line"><span class="string">registry.k8s.io/kube-controller-manager:v1.28.8</span></span><br><span class="line"><span class="string">registry.k8s.io/kube-scheduler:v1.28.8</span></span><br><span class="line"><span class="string">registry.k8s.io/kube-proxy:v1.28.8</span></span><br><span class="line"><span class="string">registry.k8s.io/pause:3.9</span></span><br><span class="line"><span class="string">registry.k8s.io/etcd:3.5.9-0</span></span><br><span class="line"><span class="string">registry.k8s.io/coredns/coredns:v1.10.1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> img <span class="keyword">in</span> <span class="variable">$&#123;img_list&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">     docker pull <span class="variable">$img</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># sh image.list</span></span><br></pre></td></tr></table></figure>



<h4 id="dokcer-proxy设置"><a href="#dokcer-proxy设置" class="headerlink" title="dokcer proxy设置"></a>dokcer proxy设置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. 设置VM网络为NAT</span><br><span class="line">2. ip route show</span><br><span class="line">default via 10.0.2.2 dev enp0s3 proto dhcp metric 100</span><br><span class="line"></span><br><span class="line">3. mkdir /etc/systemd/system/docker.service.d</span><br><span class="line">   touch /etc/systemd/system/docker.service.d/http-proxy.conf</span><br><span class="line">   vi /etc/systemd/system/docker.service.d/http-proxy.conf</span><br><span class="line">   [Service]</span><br><span class="line">   Environment=&quot;HTTP_PROXY=http://10.0.2.2:7890&quot;</span><br><span class="line">   </span><br><span class="line"> 4. systemctl daemon-reload</span><br><span class="line"> 5. systemctl resetat docker</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/EahanZhang/article/details/77453396</span><br></pre></td></tr></table></figure>

<h4 id="work-node-image"><a href="#work-node-image" class="headerlink" title="work node image"></a>work node image</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY                                TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">registry.k8s.io/kube-apiserver            v1.28.8             e70a71eaa560        8 days ago          125MB</span><br><span class="line">registry.k8s.io/kube-proxy                v1.28.8             5ce97277076c        8 days ago          81.2MB</span><br><span class="line">registry.k8s.io/kube-controller-manager   v1.28.8             e5ae3e4dc656        8 days ago          121MB</span><br><span class="line">registry.k8s.io/kube-scheduler            v1.28.8             ad3260645145        8 days ago          59.3MB</span><br><span class="line">registry.k8s.io/etcd                      3.5.9-0             73deb9a3f702        10 months ago       294MB</span><br><span class="line">registry.k8s.io/coredns/coredns           v1.10.1             ead0a4a53df8        13 months ago       53.6MB</span><br><span class="line">registry.k8s.io/pause                     3.9                 e6f181688397        17 months ago       744kB</span><br><span class="line">[root@k8s01 ~]<span class="comment"># docker save -o kube-proxy.tar registry.k8s.io/kube-proxy:v1.28.8</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># docker save -o pause.tar registry.k8s.io/pause:3.9</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># ls</span></span><br><span class="line">anaconda-ks.cfg  a.txt  image.list  kube-proxy.tar  pause.tar</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># scp kube-proxy.tar pause.tar worker1:/root</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># scp kube-proxy.tar pause.tar worker2:/root</span></span><br><span class="line"></span><br><span class="line">[root@k8s02 ~]<span class="comment"># docker load -i kube-proxy.tar</span></span><br><span class="line">76412b93a631: Loading layer [==================================================&gt;]  28.27MB/28.27MB</span><br><span class="line">ccfa800cf862: Loading layer [==================================================&gt;]   54.2MB/54.2MB</span><br><span class="line">Loaded image: registry.k8s.io/kube-proxy:v1.28.8</span><br><span class="line">[root@k8s02 ~]<span class="comment"># docker load -i pause.tar</span></span><br><span class="line">e3e5579ddd43: Loading layer [==================================================&gt;]    746kB/746kB</span><br><span class="line">Loaded image: registry.k8s.io/pause:3.9</span><br><span class="line">[root@k8s02 ~]<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY                   TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">registry.k8s.io/kube-proxy   v1.28.8             5ce97277076c        8 days ago          81.2MB</span><br><span class="line">registry.k8s.io/pause        3.9                 e6f181688397        17 months ago       744kB</span><br></pre></td></tr></table></figure>



<h3 id="k8s集群初始化"><a href="#k8s集群初始化" class="headerlink" title="k8s集群初始化"></a>k8s集群初始化</h3><h5 id="master-node"><a href="#master-node" class="headerlink" title="master node"></a>master node</h5><p><a target="_blank" rel="noopener" href="https://github.com/flannel-io/flannel/blob/master/Documentation/kube-flannel.yml">https://github.com/flannel-io/flannel/blob/master/Documentation/kube-flannel.yml</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --kubernetes-version=v1.17.17 --pod-network-cidr=172.16.0.0/16 --apiserver-advertise-address=192.168.53.176</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># kubeadm init --kubernetes-version=v1.17.17 --pod-network-cidr=172.16.0.0/16 --apiserver-advertise-address=192.168.53.176</span></span><br><span class="line">W0324 19:53:57.423681   12767 validation.go:28] Cannot validate kubelet config - no validator is available</span><br><span class="line">W0324 19:53:57.423728   12767 validation.go:28] Cannot validate kube-proxy config - no validator is available</span><br><span class="line">[init] Using Kubernetes version: v1.17.17</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">[preflight] Pulling images required <span class="keyword">for</span> setting up a Kubernetes cluster</span><br><span class="line">[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">[preflight] You can also perform this action <span class="keyword">in</span> beforehand using <span class="string">&#x27;kubeadm config images pull&#x27;</span></span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file <span class="string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span></span><br><span class="line">[kubelet-start] Writing kubelet configuration to file <span class="string">&quot;/var/lib/kubelet/config.yaml&quot;</span></span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[certs] Using certificateDir folder <span class="string">&quot;/etc/kubernetes/pki&quot;</span></span><br><span class="line">[certs] Generating <span class="string">&quot;ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver&quot;</span> certificate and key</span><br><span class="line">[certs] apiserver serving cert is signed <span class="keyword">for</span> DNS names [k8s01 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.53.176]</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver-kubelet-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;front-proxy-ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;front-proxy-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/server&quot;</span> certificate and key</span><br><span class="line">[certs] etcd/server serving cert is signed <span class="keyword">for</span> DNS names [k8s01 localhost] and IPs [192.168.53.176 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/peer&quot;</span> certificate and key</span><br><span class="line">[certs] etcd/peer serving cert is signed <span class="keyword">for</span> DNS names [k8s01 localhost] and IPs [192.168.53.176 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/healthcheck-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver-etcd-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;sa&quot;</span> key and public key</span><br><span class="line">[kubeconfig] Using kubeconfig folder <span class="string">&quot;/etc/kubernetes&quot;</span></span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;admin.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;kubelet.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;controller-manager.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;scheduler.conf&quot;</span> kubeconfig file</span><br><span class="line">[control-plane] Using manifest folder <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-apiserver&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-controller-manager&quot;</span></span><br><span class="line">W0324 19:54:01.768946   12767 manifests.go:214] the default kube-apiserver authorization-mode is <span class="string">&quot;Node,RBAC&quot;</span>; using <span class="string">&quot;Node,RBAC&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-scheduler&quot;</span></span><br><span class="line">W0324 19:54:01.769535   12767 manifests.go:214] the default kube-apiserver authorization-mode is <span class="string">&quot;Node,RBAC&quot;</span>; using <span class="string">&quot;Node,RBAC&quot;</span></span><br><span class="line">[etcd] Creating static Pod manifest <span class="keyword">for</span> <span class="built_in">local</span> etcd <span class="keyword">in</span> <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[wait-control-plane] Waiting <span class="keyword">for</span> the kubelet to boot up the control plane as static Pods from directory <span class="string">&quot;/etc/kubernetes/manifests&quot;</span>. This can take up to 4m0s</span><br><span class="line">[kubelet-check] Initial <span class="built_in">timeout</span> of 40s passed.</span><br><span class="line">[apiclient] All control plane components are healthy after 48.559102 seconds</span><br><span class="line">[upload-config] Storing the configuration used <span class="keyword">in</span> ConfigMap <span class="string">&quot;kubeadm-config&quot;</span> <span class="keyword">in</span> the <span class="string">&quot;kube-system&quot;</span> Namespace</span><br><span class="line">[kubelet] Creating a ConfigMap <span class="string">&quot;kubelet-config-1.17&quot;</span> <span class="keyword">in</span> namespace kube-system with the configuration <span class="keyword">for</span> the kubelets <span class="keyword">in</span> the cluster</span><br><span class="line">[upload-certs] Skipping phase. Please see --upload-certs</span><br><span class="line">[mark-control-plane] Marking the node k8s01 as control-plane by adding the label <span class="string">&quot;node-role.kubernetes.io/master=&#x27;&#x27;&quot;</span></span><br><span class="line">[mark-control-plane] Marking the node k8s01 as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]</span><br><span class="line">[bootstrap-token] Using token: jtgwve.4boa5316axq8hamw</span><br><span class="line">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs <span class="keyword">in</span> order <span class="keyword">for</span> nodes to get long term certificate credentials</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow certificate rotation <span class="keyword">for</span> all node client certificates <span class="keyword">in</span> the cluster</span><br><span class="line">[bootstrap-token] Creating the <span class="string">&quot;cluster-info&quot;</span> ConfigMap <span class="keyword">in</span> the <span class="string">&quot;kube-public&quot;</span> namespace</span><br><span class="line">[kubelet-finalize] Updating <span class="string">&quot;/etc/kubernetes/kubelet.conf&quot;</span> to point to a rotatable kubelet client certificate and key</span><br><span class="line">[addons] Applied essential addon: CoreDNS</span><br><span class="line">[addons] Applied essential addon: kube-proxy</span><br><span class="line"></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can <span class="built_in">join</span> any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm <span class="built_in">join</span> 192.168.53.176:6443 --token jtgwve.4boa5316axq8hamw \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:7130d2790f82d437f15c4816289f1f9a3dc671486e291ad701fcab425eec1851</span><br><span class="line">[root@k8s01 ~]<span class="comment">#                                                        </span></span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment">#  mkdir -p $HOME/.kube</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># chown $(id -u):$(id -g) $HOME/.kube/config</span></span><br><span class="line">[root@k8s01 ~]<span class="comment"># ll $HOME/.kube/config</span></span><br><span class="line">-rw------- 1 root root 5454 Mar 24 20:08 /root/.kube/config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubectl apply -f kube-flannel.yml</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># kubectl get nodes</span></span><br><span class="line">NAME    STATUS   ROLES    AGE     VERSION</span><br><span class="line">k8s01   Ready    master   7h21m   v1.17.2</span><br><span class="line">k8s02   Ready    &lt;none&gt;   4h3m    v1.17.2</span><br><span class="line">k8s03   Ready    &lt;none&gt;   4h3m    v1.17.2</span><br><span class="line">[root@k8s01 ~]<span class="comment"># kubectl get cs</span></span><br><span class="line">NAME                 STATUS    MESSAGE             ERROR</span><br><span class="line">etcd-0               Healthy   &#123;<span class="string">&quot;health&quot;</span>:<span class="string">&quot;true&quot;</span>&#125;</span><br><span class="line">controller-manager   Healthy   ok</span><br><span class="line">scheduler            Healthy   ok</span><br><span class="line">[root@k8s01 ~]<span class="comment"># kubectl cluster-info</span></span><br><span class="line">Kubernetes master is running at https://192.168.53.176:6443</span><br><span class="line">KubeDNS is running at https://192.168.53.176:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span><br><span class="line"></span><br><span class="line">To further debug and diagnose cluster problems, use <span class="string">&#x27;kubectl cluster-info dump&#x27;</span>.</span><br><span class="line">[root@k8s01 ~]<span class="comment"># kubectl get pods --namespace kube-system</span></span><br><span class="line">NAME                            READY   STATUS                  RESTARTS   AGE</span><br><span class="line">coredns-6955765f44-b2hg9        0/1     Pending                 0          3h21m</span><br><span class="line">coredns-6955765f44-fbpjw        0/1     Pending                 0          3h21m</span><br><span class="line">etcd-k8s01                      1/1     Running                 0          3h21m</span><br><span class="line">kube-apiserver-k8s01            1/1     Running                 0          3h21m</span><br><span class="line">kube-controller-manager-k8s01   1/1     Running                 0          3h21m</span><br><span class="line">kube-flannel-ds-amd64-2mxrx     0/1     Init:ImagePullBackOff   0          4m17s</span><br><span class="line">kube-flannel-ds-amd64-7pvs9     0/1     Init:ImagePullBackOff   0          4m28s</span><br><span class="line">kube-flannel-ds-amd64-qggg9     0/1     Init:ImagePullBackOff   0          5m49s</span><br><span class="line">kube-proxy-9pv9b                1/1     Running                 0          4m28s</span><br><span class="line">kube-proxy-ldjq2                1/1     Running                 0          4m17s</span><br><span class="line">kube-proxy-mv2rs                1/1     Running                 0          3h21m</span><br><span class="line">kube-scheduler-k8s01            1/1     Running                 0          3h21m</span><br><span class="line"></span><br><span class="line">[root@k8s01 ~]<span class="comment"># kubectl get pods --namespace kube-system</span></span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-6955765f44-b2hg9        1/1     Running   0          7h16m</span><br><span class="line">coredns-6955765f44-fbpjw        1/1     Running   0          7h16m</span><br><span class="line">etcd-k8s01                      1/1     Running   2          7h16m</span><br><span class="line">kube-apiserver-k8s01            1/1     Running   14         7h16m</span><br><span class="line">kube-controller-manager-k8s01   1/1     Running   3          7h16m</span><br><span class="line">kube-flannel-ds-amd64-4w5q8     1/1     Running   11         3h20m</span><br><span class="line">kube-flannel-ds-amd64-ch2qk     1/1     Running   0          3h20m</span><br><span class="line">kube-flannel-ds-amd64-hg79p     1/1     Running   0          3h20m</span><br><span class="line">kube-proxy-9pv9b                1/1     Running   1          3h59m</span><br><span class="line">kube-proxy-ldjq2                1/1     Running   1          3h59m</span><br><span class="line">kube-proxy-mv2rs                1/1     Running   1          7h16m</span><br><span class="line">kube-scheduler-k8s01            1/1     Running   4          7h16m</span><br></pre></td></tr></table></figure>



<h5 id="work-node"><a href="#work-node" class="headerlink" title="work node"></a>work node</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 192.168.53.176:6443 --token jtgwve.4boa5316axq8hamw     --discovery-token-ca-cert-hash sha256:7130d2790f82d437f15c4816289f1f9a3dc671486e291ad701fcab425eec1851             </span><br></pre></td></tr></table></figure>



<p>kubectl get namespace  </p>
<p>kubectl get ns</p>
<p>kubectl get pods</p>
<p>kubectl create namespace test</p>
<p>kubectl delete namespace test</p>
<p>cat 01-create-ns.yaml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: test01</span><br></pre></td></tr></table></figure>



<p>kubctl apply -f 01-create-ns.yaml</p>
<p>kubctl delete  -f 01-create-ns.yaml</p>
<p>kubectl get pods –namespace kube-system</p>
<p>kubectl get pods -n kube-system</p>
<p><strong>imagePullPolicy</strong>: Always &#x2F; Never &#x2F; IfNotPresent</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat 02-create-pod.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: pod1</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-pod</span><br><span class="line">    image: nginx:latest</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    ports:</span><br><span class="line">    - name: nginxport</span><br><span class="line">      containerPort: 80</span><br></pre></td></tr></table></figure>

<p>kubectl get pods -o wide</p>
<h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><table>
<thead>
<tr>
<th>Name</th>
<th>Usage</th>
</tr>
</thead>
<tbody><tr>
<td>Deployment</td>
<td>声明式更新控制器, 用于发布无状态应用</td>
</tr>
<tr>
<td>ReplicaSet</td>
<td>副本集控制器, 用于对Pod进行副本规模扩大或裁剪</td>
</tr>
<tr>
<td>StatefulSet</td>
<td>有状态副本集, 用于发布有状态应用</td>
</tr>
<tr>
<td>DaemonSet</td>
<td>在K8s集群每一个Node上运行一个副本, 用于发布监控或日志收集类等应用</td>
</tr>
<tr>
<td>Job</td>
<td>运行一次性作业任务</td>
</tr>
<tr>
<td>Cronjob</td>
<td>运行周期性作业任务</td>
</tr>
</tbody></table>
<p><strong>Deployment</strong>  </p>
<ul>
<li><p>具有上线部署, 滚动升级, 创建副本, 回滚到以前某一版本(成功&#x2F;稳定)等</p>
</li>
<li><p>Deployment包含ReplicaSet, 除非需要自定义升级功能或者根本不需要升级Pod, 否则还是建议使用Deployment还不是ReplicaSet</p>
</li>
</ul>
<p>kubectl run  nginx-app1 –image&#x3D;nginx:latest –image-pull-policy&#x3D;IfNotPresent –replicas&#x3D;2</p>
<p>Kubectl delete deployment.apps nginx-app1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 <span class="built_in">test</span>]<span class="comment">#  kubectl get deployment.apps</span></span><br><span class="line">NAME         READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-app3   2/2     2            2           135m</span><br><span class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</span><br><span class="line">[root@k8s01 <span class="built_in">test</span>]<span class="comment">#  kubectl get deployment</span></span><br><span class="line">NAME         READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-app3   2/2     2            2           135m</span><br><span class="line">[root@k8s01 <span class="built_in">test</span>]<span class="comment"># kubectl get replicaset</span></span><br><span class="line">NAME                   DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-app3-59d6dc58f   2         2         2       136m</span><br></pre></td></tr></table></figure>

<p>yaml文件创建</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cat 03-create-deployment-app.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-app2</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginxapp2-container</span><br><span class="line">        image: nginx:latest</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure>



<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><table>
<thead>
<tr>
<th>Type</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>ClusterIP</td>
<td>默认, 分配一个集群内部可以访问的虚拟IP</td>
</tr>
<tr>
<td>NodePort</td>
<td>在每个Node上分配一个端口作为一个外部访问入口</td>
</tr>
<tr>
<td>LoadBalancer</td>
<td>工作在特定的Cloud Provider上, 例如Google Cloud, AWS, OpenStack</td>
</tr>
<tr>
<td>ExternalName</td>
<td>表示把集群外部的服务引入到集群内部中来, 既实现了集群内部的Pod与集群外部的服务进行通信</td>
</tr>
</tbody></table>
<p>kubectl run nginx-app1 –image&#x3D;nginx:latest –image-pull-policy&#x3D;IfNotPresent –replicas&#x3D;1</p>
<p>kubectl expose deployment.apps nginx-app1 –type&#x3D;ClusterIP –target-port&#x3D;80 <strong>–port&#x3D;80</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s01 ~]<span class="comment"># kubectl get endpoints</span></span><br><span class="line">NAME             ENDPOINTS                     AGE</span><br><span class="line">kubernetes       192.168.53.176:6443           12h</span><br><span class="line">nginx-app3-svc   172.16.1.3:80,172.16.2.3:80   163m</span><br><span class="line">[root@k8s01 ~]<span class="comment"># kubectl get svc</span></span><br><span class="line">NAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes       ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP   12h</span><br><span class="line">nginx-app3-svc   ClusterIP   10.101.203.25   &lt;none&gt;        80/TCP    164m</span><br><span class="line">[root@k8s01 ~]<span class="comment">#                                                             </span></span><br></pre></td></tr></table></figure>



<p>kubectl get service</p>
<p>kubectl get svc</p>
<p>kubectl get endpoints</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f 04-create-depolyment-nginx-app2-service.yaml</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-app3</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginxapp3</span><br><span class="line">        image: nginx:latest</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-app3-svc</span><br><span class="line">spec:</span><br><span class="line">  type: ClusterIP</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br><span class="line">  ports:</span><br><span class="line">  - protocol: TCP</span><br><span class="line">    port: 80</span><br><span class="line">    targetPort: 80</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br></pre></td></tr></table></figure>



<p>kubectl get pods</p>
<p>kubectl exec -it podName bash</p>
<p>[root@k8s01 ~]# kubectl exec -it nginx-app3-59d6dc58f-lc7wj bash </p>
<p>sed -ri ‘s&#x2F;nginx2.com&#x2F;nginx.com&#x2F;‘ index.html</p>
<h4 id="node-pod-service"><a href="#node-pod-service" class="headerlink" title="node pod service"></a>node pod service</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-app3</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx-app3</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx-app3</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        apps: nginx-app3</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginxapp3</span><br><span class="line">        image: nginx:latest</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-app3-svc</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br><span class="line">  ports:</span><br><span class="line">  - protocol: TCP</span><br><span class="line">    port: 80</span><br><span class="line">    targetPort: 80</span><br><span class="line">    nodePort: 30001 #30000-32767</span><br><span class="line">  selector:</span><br><span class="line">    apps: nginx-app3</span><br></pre></td></tr></table></figure>

<p>ss -anput |grep “:30001”</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/23/20240323-k8s-notes-md/" data-id="cluj864t10000ioo68qtgatoy" data-title="k8s 学习笔记" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-20240319-hexo-disply-image-md" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/19/20240319-hexo-disply-image-md/" class="article-date">
  <time class="dt-published" datetime="2024-03-19T13:26:23.000Z" itemprop="datePublished">2024-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/19/20240319-hexo-disply-image-md/">解决Hexo 显示图片的问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>用Hexo写个人blog, 会遇到插入图片显示不对的问题, 可参考如下两个Link解决, 具体的步骤, 总结下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">修改_config.yml</span><br><span class="line">post_asset_folder: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">npm install hexo-image-link --save</span><br><span class="line"></span><br><span class="line">{% asset_img "image-name.jpg" "label" %}</span><br><span class="line"></span><br><span class="line">hexo generate</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://github.com/cocowool/hexo-image-link">hexo-image-link</a></p>
<p><a target="_blank" rel="noopener" href="http://edulinks.cn/2020/03/14/20200314-write-hexo-with-typora/">wirte hexo with typora</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/19/20240319-hexo-disply-image-md/" data-id="cltyf0e4e000065o6dr89hleb" data-title="解决Hexo 显示图片的问题" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9D%91/" rel="tag">坑</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-20240319-pytest-learing-notes-md" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/19/20240319-pytest-learing-notes-md/" class="article-date">
  <time class="dt-published" datetime="2024-03-19T12:41:00.000Z" itemprop="datePublished">2024-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/19/20240319-pytest-learing-notes-md/">Pytest 学习笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="Pytest-依赖包"><a href="#Pytest-依赖包" class="headerlink" title="Pytest 依赖包"></a>Pytest 依赖包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pytest</span><br><span class="line">pytest-html</span><br><span class="line">pytest-xdist</span><br><span class="line">pytest-ordering</span><br><span class="line">pytest-rerunfailures</span><br><span class="line">allure-pytest</span><br><span class="line">PyYAML</span><br></pre></td></tr></table></figure>



<h3 id="默认测试用例的命名规则"><a href="#默认测试用例的命名规则" class="headerlink" title="默认测试用例的命名规则"></a>默认测试用例的命名规则</h3><ol>
<li>模块名必须以test_开头或者__test结尾.</li>
<li>测试类名必须以Test开头, 并且不能用init方法.</li>
<li>测试方法必须以test开头.</li>
</ol>
<h3 id="Pytest执行方式"><a href="#Pytest执行方式" class="headerlink" title="Pytest执行方式"></a>Pytest执行方式</h3><ol>
<li><p>main函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main([<span class="string">&#x27;-vs&#x27;</span>])</span><br><span class="line">    </span><br></pre></td></tr></table></figure>


</li>
<li><p>命令行</p>
<ul>
<li>-n&#x3D;线程数, 并行执行</li>
<li>-v 详细输出</li>
<li>–reruns&#x3D;number, 失败后rerun次数</li>
<li>-x 只要有一个fail, 停止执行</li>
<li>–maxfail&#x3D;2, 有2个测试失败, 停止执行</li>
<li>-k “one” 执行测试用例的包含”one”的</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(.venv) (base) mytest % pytest -vs</span><br><span class="line">=============================================================== <span class="built_in">test</span> session starts ================================================================</span><br><span class="line">platform darwin -- Python 3.11.7, pytest-8.1.1, pluggy-1.4.0 -- ~/mytest/.venv/bin/python</span><br><span class="line">cachedir: .pytest_cache</span><br><span class="line">metadata: &#123;<span class="string">&#x27;Python&#x27;</span>: <span class="string">&#x27;3.11.7&#x27;</span>, <span class="string">&#x27;Platform&#x27;</span>: <span class="string">&#x27;macOS-14.4-arm64-arm-64bit&#x27;</span>, <span class="string">&#x27;Packages&#x27;</span>: &#123;<span class="string">&#x27;pytest&#x27;</span>: <span class="string">&#x27;8.1.1&#x27;</span>, <span class="string">&#x27;pluggy&#x27;</span>: <span class="string">&#x27;1.4.0&#x27;</span>&#125;, <span class="string">&#x27;Plugins&#x27;</span>: &#123;<span class="string">&#x27;html&#x27;</span>: <span class="string">&#x27;4.1.1&#x27;</span>, <span class="string">&#x27;metadata&#x27;</span>: <span class="string">&#x27;3.1.1&#x27;</span>, <span class="string">&#x27;rerunfailures&#x27;</span>: <span class="string">&#x27;14.0&#x27;</span>, <span class="string">&#x27;ordering&#x27;</span>: <span class="string">&#x27;0.6&#x27;</span>, <span class="string">&#x27;allure-pytest&#x27;</span>: <span class="string">&#x27;2.13.3&#x27;</span>, <span class="string">&#x27;xdist&#x27;</span>: <span class="string">&#x27;3.5.0&#x27;</span>&#125;&#125;</span><br><span class="line">rootdir: ~/workspace/mytest</span><br><span class="line">plugins: html-4.1.1, metadata-3.1.1, rerunfailures-14.0, ordering-0.6, allure-pytest-2.13.3, xdist-3.5.0</span><br><span class="line">collected 1 item                                                                                                                                   </span><br><span class="line"></span><br><span class="line">src/testcase/test_one.py::TestOne::test_01_hello_world Test: Hello world!</span><br><span class="line">PASSED</span><br><span class="line">================================================================ 1 passed <span class="keyword">in</span> 0.00s =================================================================</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>通过读取pytest.ini配置文件运行</p>
</li>
<li><p>指定特殊的文件运行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main([<span class="string">&#x27;-vs&#x27;</span>, <span class="string">&#x27;src/testcase/test_one.py&#x27;</span>,<span class="string">&#x27;src/testcase/test_two.py&#x27;</span>])</span><br></pre></td></tr></table></figure>


</li>
<li><p>指定特殊的目录执行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main([<span class="string">&#x27;-vs&#x27;</span>, <span class="string">&#x27;src/testcase/module1&#x27;</span>])</span><br></pre></td></tr></table></figure>


</li>
<li><p>通过Node ID运行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main([<span class="string">&#x27;-vs&#x27;</span>, <span class="string">&#x27;src/testcase/module1/test_module1.py::TestModule1::testMyModule1testCase&#x27;</span>])</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Pytest执行顺序"><a href="#Pytest执行顺序" class="headerlink" title="Pytest执行顺序"></a>Pytest执行顺序</h3><p>从上到下执行</p>
<p><strong>通过@pytest.mark.run(order&#x3D;1)</strong> 改变执行顺序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@pytest.mark.run(<span class="params">order=<span class="number">1</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_02_hello_world</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Test 02: Hello world!&quot;</span>)</span><br></pre></td></tr></table></figure>



<ul>
<li>通过pytest.ini单元测试的核心配置文件运行, <ol>
<li>一般放在项目的根目录</li>
<li>编码必须是ANSI</li>
<li>改变pytest默认行为</li>
</ol>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[pytest]</span><br><span class="line">addopts = -vs</span><br><span class="line">testpaths = ./src/</span><br><span class="line">python_files = test*.py</span><br><span class="line">python_classes = Test*</span><br><span class="line">python_functions = test</span><br></pre></td></tr></table></figure>



<h3 id="分组执行"><a href="#分组执行" class="headerlink" title="分组执行"></a>分组执行</h3><ol>
<li><p>方法名前加上自定义标记@pytest.mark.group1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@pytest.mark.group1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">testMytestCase003</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Test my test case 3&quot;</span>)</span><br></pre></td></tr></table></figure>


</li>
<li><p>修改pytest.ini, 增加markers</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[pytest]</span><br><span class="line">addopts = -vs</span><br><span class="line">testpaths = ./src/</span><br><span class="line">python_files = test*.py</span><br><span class="line">python_classes = Test*</span><br><span class="line">python_functions = test</span><br><span class="line">markers = </span><br><span class="line">      group1: test module 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ol start="3">
<li>命令行增加参数-m 标记名</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pytest.main([<span class="string">&#x27;-vs&#x27;</span>, <span class="string">&#x27;-m group1&#x27;</span>])</span><br><span class="line">    </span><br><span class="line">运行两个以上的标记用 <span class="keyword">or</span> 放在两个标记之间</span><br><span class="line">pytest -vs -m <span class="string">&quot;group1 or group2 or group3&quot;</span></span><br></pre></td></tr></table></figure>







<h3 id="跳过测试用例"><a href="#跳过测试用例" class="headerlink" title="跳过测试用例"></a>跳过测试用例</h3><ol>
<li><p>无条件跳过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@pytest.mark.skip(reason=&quot;I don&#x27;t like it.&quot;)</span><br></pre></td></tr></table></figure>


</li>
<li><p>有条件跳过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flag = 18</span><br><span class="line"></span><br><span class="line">@pytest.mark.skipif(flag &gt; 18, reason=&#x27;Skip it.&#x27;)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Setup-teardown"><a href="#Setup-teardown" class="headerlink" title="Setup&#x2F;teardown"></a>Setup&#x2F;teardown</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestTwo</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setup_method</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;This is setup before method&quot;</span>)</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setup_class</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;This is setup before class&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">teardown_method</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;This is setup after method&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">teardown_class</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;This is setup after class&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">testMytestCase001</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Test my test case 1&quot;</span>)</span><br><span class="line">        </span><br><span class="line">src/testcase/test_two.py::TestTwo::testMytestCase003 This <span class="keyword">is</span> setup before <span class="keyword">class</span></span><br><span class="line"><span class="title class_">This</span> <span class="keyword">is</span> setup before method</span><br><span class="line">Test my test <span class="keyword">case</span> <span class="number">3</span></span><br><span class="line">PASSEDThis <span class="keyword">is</span> setup after method</span><br><span class="line">This <span class="keyword">is</span> setup after <span class="keyword">class</span></span><br></pre></td></tr></table></figure>



<h3 id="生成测试报告"><a href="#生成测试报告" class="headerlink" title="生成测试报告"></a>生成测试报告</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[pytest]</span><br><span class="line">addopts = -vs --html ./report/report.html</span><br></pre></td></tr></table></figure>



<h3 id="使用-pytest-fixture-装饰器"><a href="#使用-pytest-fixture-装饰器" class="headerlink" title="使用@pytest.fixture()装饰器"></a>使用@pytest.fixture()装饰器</h3><p>@pytest.fixture(scope&#x3D;’’, params&#x3D;’’, autouse&#x3D;’’, ids&#x3D;’’, name&#x3D;’’)</p>
<ul>
<li>Scope 表明被pytest.fixture标记方法的作用域. function(默认), class, module, package&#x2F;session</li>
<li>params,  参数化, 支持list[], tuple(), 自带字典列表[{}], 字典元组({})</li>
<li>autouse&#x3D;True, 自动执行, 默认False, 无需有方法体内参数上引用函数名做为形参</li>
<li>ids, 当使用params参数化时, 给每一个值设置一个变量名</li>
<li>name, 表示是被@pytest.fixture标记的方法取一个别名, 当取了别名, 原有的名字就不能使用了.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import pytest</span><br><span class="line"></span><br><span class="line">@pytest.fixture(scope=&#x27;function&#x27;)</span><br><span class="line">def beforeAfterMethod():</span><br><span class="line">    print(&#x27;this is a before step&#x27;)</span><br><span class="line">    yield</span><br><span class="line">    print(&#x27;this is a after step&#x27;)</span><br><span class="line"></span><br><span class="line">class TestTwo:</span><br><span class="line">    flag = 18</span><br><span class="line"></span><br><span class="line">    def setup_method(self):</span><br><span class="line">        print(&quot;This is setup before method&quot;)</span><br><span class="line">   </span><br><span class="line">    def setup_class(self):</span><br><span class="line">        print(&quot;This is setup before class&quot;)</span><br><span class="line"></span><br><span class="line">    def teardown_method(self):</span><br><span class="line">        print(&quot;This is setup after method&quot;)</span><br><span class="line"></span><br><span class="line">    def teardown_class(self):</span><br><span class="line">        print(&quot;This is setup after class&quot;)</span><br><span class="line"></span><br><span class="line">    def testMytestCase001(self):</span><br><span class="line">        print(&quot;Test my test case 1&quot;)</span><br><span class="line"></span><br><span class="line">    def testMytestCase002(self):</span><br><span class="line">        print(&quot;Test my test case 2&quot;)</span><br><span class="line">    </span><br><span class="line">    @pytest.mark.group1</span><br><span class="line">    @pytest.mark.skipif(flag &gt; 18, reason=&#x27;Skip it.&#x27;)</span><br><span class="line">    def testMytestCase003(self,beforeAfterMethod ):</span><br><span class="line">        print(&quot;Test my test case 3&quot;)</span><br><span class="line"></span><br><span class="line">src/testcase/test_two.py::TestTwo::testMytestCase003 </span><br><span class="line">This is setup before class</span><br><span class="line">This is setup before method</span><br><span class="line">this is a before step</span><br><span class="line">Test my test case 3</span><br><span class="line">PASSEDthis is a after step</span><br><span class="line">This is setup after method</span><br><span class="line">This is setup after class</span><br></pre></td></tr></table></figure>



<p>参数化通过<strong>yield request.param</strong>返回具体参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">@pytest.fixture(scope=&#x27;function&#x27;, params=[&#x27;aa&#x27;, &#x27;bb&#x27;, &#x27;cc&#x27;])</span><br><span class="line">def beforeAfterMethod(request):</span><br><span class="line">    print(&#x27;this is a before step&#x27;)</span><br><span class="line">    yield request.param</span><br><span class="line">    print(&#x27;this is a after step&#x27;)</span><br><span class="line">    </span><br><span class="line"> def testMytestCase003(self, beforeAfterMethod):</span><br><span class="line">    print(f&quot;Test my test case 3 &#123;beforeAfterMethod&#125;&quot;)</span><br><span class="line">    </span><br><span class="line">src/testcase/test_two.py::TestTwo::testMytestCase003[aa] This is setup before class</span><br><span class="line">This is setup before method</span><br><span class="line">this is a before step</span><br><span class="line">Test my test case 3 aa</span><br><span class="line">PASSEDthis is a after step</span><br><span class="line">This is setup after method</span><br><span class="line"></span><br><span class="line">src/testcase/test_two.py::TestTwo::testMytestCase003[bb] This is setup before method</span><br><span class="line">this is a before step</span><br><span class="line">Test my test case 3 bb</span><br><span class="line">PASSEDthis is a after step</span><br><span class="line">This is setup after method</span><br><span class="line"></span><br><span class="line">src/testcase/test_two.py::TestTwo::testMytestCase003[cc] This is setup before method</span><br><span class="line">this is a before step</span><br><span class="line">Test my test case 3 cc</span><br><span class="line">PASSEDthis is a after step</span><br><span class="line">This is setup after method</span><br><span class="line">This is setup after class</span><br></pre></td></tr></table></figure>



<p><strong>结合conftest.py使用</strong></p>
<ul>
<li><p>conftest.py是单独的存放的一个夹具配置文件, 名称不可改</p>
</li>
<li><p>可以跨文件使用</p>
</li>
<li><p>conftest.py需要和运行的用例放到同一层, 并且不需要导入.</p>
</li>
<li><p>使用多个conftest.py, 如下图, 按列出的先后顺序执行.</p>
<img src="/2024/03/19/20240319-pytest-learing-notes-md/2024-03-18.png" class="" title="label"></li>
</ul>
<p>总结:</p>
<ol>
<li>Setup&#x2F;teardown 它是作用于所有用例</li>
<li>@pytest.fixture(), 它的作用既可以部分也可以全部前后置</li>
<li>conftest.py和@pytest.fixture()结合使用, 作用于前后置.</li>
</ol>
<h3 id="pytest-结合allure-pytest插件生成allure测试报告"><a href="#pytest-结合allure-pytest插件生成allure测试报告" class="headerlink" title="pytest 结合allure-pytest插件生成allure测试报告"></a>pytest 结合allure-pytest插件生成allure测试报告</h3><ol>
<li><p>下载, 解压, 配置path路径</p>
<p>地址: <a target="_blank" rel="noopener" href="https://github.com/allure-framework/allure2">allure2</a></p>
</li>
</ol>
<p>​        验证 allure –version</p>
<ol start="2">
<li><p>加命令生成json格式的临时报告.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--alluredir ./tmep</span><br></pre></td></tr></table></figure>


</li>
<li><p>生成allure报告</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allure genrate ./temp -o ./report --clean</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="使用-pytest-mark-parametrize"><a href="#使用-pytest-mark-parametrize" class="headerlink" title="使用@pytest.mark.parametrize()"></a>使用@pytest.mark.parametrize()</h3><p>@pytest.mark.parametrize(args_name, args_value)</p>
<p>args_name: 参数名</p>
<p>args_value: 参数值, 支持list[], tuple(), 自带字典列表[{}], 字典元组({})</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&#x27;name1&#x27;</span>, [<span class="string">&#x27;aa&#x27;</span>, <span class="string">&#x27;bb&#x27;</span>, <span class="string">&#x27;cc&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">testMyModule1testCase</span>(<span class="params">self, name1</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Test my module case 1 <span class="subst">&#123;name1&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&#x27;k,v&#x27;</span>, [[<span class="string">&#x27;aa&#x27;</span>,<span class="number">1</span>], [<span class="string">&#x27;bb&#x27;</span>,<span class="number">2</span>], [<span class="string">&#x27;cc&#x27;</span>,<span class="number">3</span>]]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">testMyModule1testCase</span>(<span class="params">self, k, v</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Test my module case 1 <span class="subst">&#123;k&#125;</span>:<span class="subst">&#123;v&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>



<p><strong>YAML</strong></p>
<p>支持注释, 换行, 多行字符串, 裸字符串(整形, 字符串)</p>
<ol>
<li>区分大小写</li>
<li>用缩进表示层级, 不能使用tab, 只能用空格</li>
<li>缩进没有数量, 只要对齐就行</li>
</ol>
<p>数据组成</p>
<ol>
<li><p>Map对象, </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">My</span> <span class="string">name</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">18</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">data2:</span> &#123;<span class="attr">name:</span> <span class="string">name2</span>, <span class="attr">age:</span> <span class="number">18</span>&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>数组对象,</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">data:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="number">1</span></span><br><span class="line">   <span class="bullet">-</span> <span class="number">2</span></span><br><span class="line">   <span class="bullet">-</span> <span class="number">3</span></span><br><span class="line">  </span><br><span class="line"><span class="bullet">-</span> <span class="number">4</span></span><br><span class="line"><span class="bullet">-</span> <span class="number">5</span></span><br><span class="line"><span class="bullet">-</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过YAML数据驱动测试用例</p>
<p>YamlUtil.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">YamlUtil</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, yaml_file</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.yaml_file = yaml_file</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">readFile</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(self.yaml_file, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            val = yaml.full_load(f)</span><br><span class="line">            <span class="keyword">return</span> val</span><br><span class="line">          </span><br></pre></td></tr></table></figure>

<p>Test_api.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, os</span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">from</span> util.YamlUtil <span class="keyword">import</span> YamlUtil</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestApi</span>:</span><br><span class="line"></span><br><span class="line"><span class="meta">    @pytest.mark.parametrize(<span class="params"><span class="string">&#x27;args&#x27;</span>, YamlUtil(<span class="params">os.path.join(<span class="params">os.getcwd(<span class="params"></span>),<span class="string">&#x27;src/util/test.yaml&#x27;</span></span>)</span>).readFile(<span class="params"></span>)</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">testApi1</span>(<span class="params">self, args</span>):</span><br><span class="line">         url = args[<span class="string">&#x27;url&#x27;</span>]</span><br><span class="line">         res = requests.get(url)</span><br><span class="line">         <span class="keyword">assert</span> res.status_code == args[<span class="string">&#x27;eq&#x27;</span>][<span class="string">&#x27;statuscode&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>test.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> </span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://www.bing.com/search?q=</span></span><br><span class="line">    <span class="attr">keyword:</span> <span class="string">哈哈哈</span></span><br><span class="line">    <span class="attr">eq:</span></span><br><span class="line">      <span class="attr">statuscode:</span> <span class="number">200</span></span><br><span class="line"><span class="bullet">-</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://www.baidu.com/s?wd=</span></span><br><span class="line">    <span class="attr">keyword:</span> <span class="string">你好</span></span><br><span class="line">    <span class="attr">eq:</span></span><br><span class="line">      <span class="attr">statuscode:</span> <span class="number">200</span></span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/19/20240319-pytest-learing-notes-md/" data-id="cltyd9lsk0000nko6gfz32ne0" data-title="Pytest 学习笔记" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/14/hello-world/" class="article-date">
  <time class="dt-published" datetime="2024-03-14T12:42:19.000Z" itemprop="datePublished">2024-03-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/14/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/14/hello-world/" data-id="cltr92p280000g7o6e2vl828x" data-title="Hello World" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Java-学习笔记-Lambda" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/11/Java-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Lambda/" class="article-date">
  <time class="dt-published" datetime="2024-03-11T13:42:15.000Z" itemprop="datePublished">2024-03-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/11/Java-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Lambda/">Java 学习笔记--Lambda</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><ol>
<li><p>一个参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msg -&gt; System.out.println(msg)</span><br><span class="line">一个参数无需()</span><br></pre></td></tr></table></figure></li>
<li><p>多个参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(a, b) -&gt; a + b</span><br><span class="line">参数无需类型声明, 函数体内单条语句,无需return, 也不需要花括号</span><br></pre></td></tr></table></figure></li>
<li><p>无参</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">() -\&gt; System.out.println(&quot;Hello world&quot;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>多条语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(a, b) -\&gt; &#123;</span><br><span class="line">  a = a * b;</span><br><span class="line">  b = b * a;</span><br><span class="line">&#125;</span><br><span class="line">多条语句返回需要return, 且需要用花括号</span><br></pre></td></tr></table></figure>
</li>
<li><p>空函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">() -\&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a>函数式接口</h3><p>要求Lambda表达式实现的接口只能有一个抽象的方法, 这样的接口称为函数式接口.<br>为了避免接口中出现多个抽象方法, 可以接口上使用@FunctionalInterface注解, 声明该接口是一个函数式接口,如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MathOperation</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">operation</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方法引用"><a href="#方法引用" class="headerlink" title="方法引用"></a>方法引用</h3><ul>
<li>对象 :: 实例方法名</li>
<li>类名 :: 静态方法名</li>
<li>类名 :: 实例方法名</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.BiPredicate;</span><br><span class="line"><span class="keyword">import</span> java.util.function.BinaryOperator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MathUtil</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span> <span class="params">(<span class="type">int</span> a , <span class="type">int</span> b)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">subtract</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a - b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodRef</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">operate</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, BinaryOperator&lt;Integer&gt; operator)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> operator.apply(a, b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">MathUtil</span> <span class="variable">math</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MathUtil</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">addRes1</span> <span class="operator">=</span> operate(<span class="number">5</span>, <span class="number">3</span>, math::add);</span><br><span class="line">        <span class="type">int</span> <span class="variable">addRes2</span> <span class="operator">=</span> operate( <span class="number">5</span>, <span class="number">3</span>, (a, b) -&gt; math.add(a, b));</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;%d + %d = res1(%d), res2(%d)&quot;</span>, <span class="number">5</span>, <span class="number">3</span>, addRes1, addRes2));</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">subRes1</span> <span class="operator">=</span> operate(<span class="number">5</span>, <span class="number">3</span>, MathUtil::subtract);</span><br><span class="line">        <span class="type">int</span> <span class="variable">subRes2</span> <span class="operator">=</span> operate(<span class="number">5</span>, <span class="number">3</span>, (a, b) -&gt; MathUtil.subtract(a, b));</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;%d - %d = res1(%d), res2(%d)&quot;</span>, <span class="number">5</span>, <span class="number">3</span>, subRes1, subRes2));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//类名 :: 实例方法名, 这里是将函数式接口方法的第一个参数作为调用实例方法的对象, 接口方法的其它参数作为实例方法的参数.</span></span><br><span class="line">        BiPredicate&lt;String, String&gt; bp1 = String::equals;</span><br><span class="line">        BiPredicate&lt;String, String&gt; bp2 = (a, b) -&gt; a.equals(b);</span><br><span class="line">        System.out.println(bp1.test(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>));</span><br><span class="line">        System.out.println(bp2.test(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output:</span><br><span class="line"><span class="number">5</span> + <span class="number">3</span> = res1(<span class="number">8</span>), res2(<span class="number">8</span>)</span><br><span class="line"><span class="number">5</span> - <span class="number">3</span> = res1(<span class="number">2</span>), res2(<span class="number">2</span>)</span><br><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="构造方法引用"><a href="#构造方法引用" class="headerlink" title="构造方法引用"></a>构造方法引用</h3><p><strong>类名::new</strong><br>对应的函数式接口中的方法需要有返回值, 构造方法的参数列表要与接口中方法的参数列表一致.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.function.BiFunction;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> no;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>(<span class="number">0</span>, <span class="string">&quot;None&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(<span class="type">int</span> no)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>(no, <span class="string">&quot;None&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(<span class="type">int</span> no , String name)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.no = no;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> no + <span class="string">&quot; : &quot;</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConstructorRef</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        Supplier&lt;Student&gt; s1 = Student::<span class="keyword">new</span>;</span><br><span class="line">        Supplier&lt;Student&gt; s2 = () -&gt; <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        System.out.println(s1.get());</span><br><span class="line">        System.out.println(s2.get());</span><br><span class="line"></span><br><span class="line">        Function&lt;Integer, Student&gt; fun1 = Student::<span class="keyword">new</span>;</span><br><span class="line">        Function&lt;Integer, Student&gt; fun2 = no -&gt; <span class="keyword">new</span> <span class="title class_">Student</span>(no);</span><br><span class="line">        System.out.println(fun1.apply(<span class="number">1</span>));</span><br><span class="line">        System.out.println(fun2.apply(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        BiFunction&lt;Integer, String, Student&gt; biFun1 = Student::<span class="keyword">new</span>;</span><br><span class="line">        BiFunction&lt;Integer, String, Student&gt; biFun2 = (no, name) -&gt; <span class="keyword">new</span> <span class="title class_">Student</span>(no, name);</span><br><span class="line">        System.out.println(biFun1.apply(<span class="number">1</span>, <span class="string">&quot;name1&quot;</span>));</span><br><span class="line">        System.out.println(biFun2.apply(<span class="number">2</span>, <span class="string">&quot;name2&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h3 id="数组引用"><a href="#数组引用" class="headerlink" title="数组引用"></a>数组引用</h3><p><strong>type[]::new</strong> 例如Integer[]::new, 与构造方法类似.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">        Function&lt;Integer, Integer[]&gt; fun1 = Integer[]::<span class="keyword">new</span>;</span><br><span class="line">        Function&lt;Integer, Integer[]&gt; fun2 = (n) -&gt;<span class="keyword">new</span> <span class="title class_">Integer</span>[n];</span><br><span class="line">        Integer[] intArr = fun1.apply(<span class="number">10</span>);</span><br><span class="line">        Integer[] intArr2 = fun2.apply(<span class="number">10</span>);</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;Array 1 size is %d&quot;</span>, intArr.length));</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;Array 2 size is %d&quot;</span>, intArr2.length));</span><br><span class="line"></span><br><span class="line">output:</span><br><span class="line">Array <span class="number">1</span> size is <span class="number">10</span></span><br><span class="line">Array <span class="number">2</span> size is <span class="number">10</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/11/Java-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Lambda/" data-id="cltr83b4b0000g1o65yaig2wz" data-title="Java 学习笔记--Lambda" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Windows上增加Ssh-key遇到的问题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/02/21/Windows%E4%B8%8A%E5%A2%9E%E5%8A%A0Ssh-key%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2024-02-21T13:29:15.000Z" itemprop="datePublished">2024-02-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/02/21/Windows%E4%B8%8A%E5%A2%9E%E5%8A%A0Ssh-key%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/">Github：Windows上增加Ssh key遇到的问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="第一步，-先安装Git"><a href="#第一步，-先安装Git" class="headerlink" title="第一步， 先安装Git"></a>第一步， 先安装Git</h3><h3 id="打开git-bash-运行下面命令生成key"><a href="#打开git-bash-运行下面命令生成key" class="headerlink" title="打开git bash,运行下面命令生成key,"></a>打开git bash,运行下面命令生成key,</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; ssh-keygen -t ed25519 -C <span class="string">&quot;your_email@example.com&quot;</span></span><br><span class="line"></span><br><span class="line">&gt; Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/c/Users/YOU/.ssh/id_ALGORITHM):[Press enter]</span><br><span class="line"></span><br><span class="line">&gt; Enter passphrase (empty <span class="keyword">for</span> no passphrase): [Type a passphrase]</span><br><span class="line">&gt; Enter same passphrase again: [Type passphrase again]</span><br></pre></td></tr></table></figure>

<h3 id="运行-ssh-add-l-检查ssh服务是否启动，-如没有，-通过下面的命令，-以管理员权限打开Power-shell-启动ssh-agent"><a href="#运行-ssh-add-l-检查ssh服务是否启动，-如没有，-通过下面的命令，-以管理员权限打开Power-shell-启动ssh-agent" class="headerlink" title="运行 ssh-add -l, 检查ssh服务是否启动， 如没有， 通过下面的命令， 以管理员权限打开Power shell, 启动ssh agent"></a>运行 ssh-add -l, 检查ssh服务是否启动， 如没有， 通过下面的命令， 以管理员权限打开Power shell, 启动ssh agent</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-add -l</span><br><span class="line"></span><br><span class="line">Get-Service -Name ssh-agent | Set-Service -StartupType Manual</span><br><span class="line">Start-Service ssh-agent</span><br></pre></td></tr></table></figure>


<h3 id="错误-这时候如果先ssh-add-private-key-会有如下报借"><a href="#错误-这时候如果先ssh-add-private-key-会有如下报借" class="headerlink" title="错误, 这时候如果先ssh-add private key, 会有如下报借"></a>错误, 这时候如果先ssh-add private key, 会有如下报借</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(base) PS C:\WINDOWS\system32&gt; ssh-add C:\Users\UserName\.ssh\id_ed25519</span><br><span class="line">Bad permissions. Try removing permissions <span class="keyword">for</span> user: \\Everyone (S-1-1-0) on file C:/Users/UserName/.ssh/id_ed25519.</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">Permissions <span class="keyword">for</span> <span class="string">&#x27;C:\\Users\\UserName\\.ssh\\id_ed25519&#x27;</span> are too open.</span><br><span class="line">It is required that your private key files are NOT accessible by others.</span><br></pre></td></tr></table></figure>

<h3 id="修改-Winodws下private-key的权限"><a href="#修改-Winodws下private-key的权限" class="headerlink" title="修改 Winodws下private key的权限"></a><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a1314a9448fa">修改</a> Winodws下private key的权限</h3><ul>
<li>右键打开私钥文件或其所在文件夹的属性，点击安全选项卡中的高级选项，在弹出窗口中点击左下角的禁用继承，接着选择从此对象中删除所有已继承的权限。这样就首先删除了所有权限</li>
<li>下一步还需要添加用户的权限。点击刚才禁用继承选项上方的添加，弹出菜单中点击左上角的选择主体，在选择用户或组窗口的下方有输入要选择的对象名称窗口，这里输入Windows用户名（如：Administrator等）然后检查名称，如果用户名没有问题的话就会自动匹配用户名，然后确定，在权限项目窗口中选择完全控制，然后确定</li>
</ul>
<h3 id="通过ssh-add把private-key加入ssh-agent"><a href="#通过ssh-add把private-key加入ssh-agent" class="headerlink" title="通过ssh-add把private key加入ssh agent"></a>通过ssh-add把private key加入ssh agent</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-add -l</span><br><span class="line">ssh-add C:\Users\yUserName\.ssh\id_ed25519</span><br></pre></td></tr></table></figure>


<h3 id="上传Ssh-public-key到Github"><a href="#上传Ssh-public-key到Github" class="headerlink" title="上传Ssh public key到Github"></a>上传Ssh public key到Github</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Win11用下面这个命令复制到粘贴板</span><br><span class="line"><span class="built_in">cat</span> ~/.ssh/id_ed25519.pub | clip</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/02/21/Windows%E4%B8%8A%E5%A2%9E%E5%8A%A0Ssh-key%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/" data-id="cltr83b4e0002g1o6b9ndbf0g" data-title="Github：Windows上增加Ssh key遇到的问题" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9D%91/" rel="tag">坑</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Linux-shell-学习笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/02/21/Linux-shell-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2024-02-21T12:18:24.000Z" itemprop="datePublished">2024-02-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/02/21/Linux-shell-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Linux-shell-学习笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Markdown"><a href="#Markdown" class="headerlink" title="Markdown"></a>Markdown</h2><table>
<thead>
<tr>
<th>language</th>
<th>key</th>
</tr>
</thead>
<tbody><tr>
<td>C</td>
<td>c</td>
</tr>
<tr>
<td>ActionScript</td>
<td>actionscript</td>
</tr>
<tr>
<td>Apache</td>
<td>apache</td>
</tr>
<tr>
<td>AppleScript</td>
<td>applescript</td>
</tr>
<tr>
<td>AsciiDoc</td>
<td>asciidoc</td>
</tr>
<tr>
<td>AspectJ</td>
<td>asciidoc</td>
</tr>
<tr>
<td>AutoHotkey</td>
<td>autohotkey</td>
</tr>
<tr>
<td>AVR Assembler</td>
<td>avrasm</td>
</tr>
<tr>
<td>Axapta</td>
<td>axapta</td>
</tr>
<tr>
<td>Bash</td>
<td>bash</td>
</tr>
<tr>
<td>BrainFuck</td>
<td>brainfuck</td>
</tr>
<tr>
<td>Cap’n Proto</td>
<td>capnproto</td>
</tr>
<tr>
<td>Clojure REPL</td>
<td>clojure</td>
</tr>
<tr>
<td>Clojure</td>
<td>clojure</td>
</tr>
<tr>
<td>CMake</td>
<td>cmake</td>
</tr>
<tr>
<td>CoffeeScript</td>
<td>coffeescript</td>
</tr>
<tr>
<td>C++</td>
<td>cpp</td>
</tr>
<tr>
<td>C#</td>
<td>cs</td>
</tr>
<tr>
<td>CSS</td>
<td>css</td>
</tr>
<tr>
<td>D</td>
<td>d</td>
</tr>
<tr>
<td>Dart</td>
<td>d</td>
</tr>
<tr>
<td>Delphi</td>
<td>delphi</td>
</tr>
<tr>
<td>Diff</td>
<td>diff</td>
</tr>
<tr>
<td>Django</td>
<td>django</td>
</tr>
<tr>
<td>DOS.bat</td>
<td>dos</td>
</tr>
<tr>
<td>Dust</td>
<td>dust</td>
</tr>
<tr>
<td>Elixir</td>
<td>elixir</td>
</tr>
<tr>
<td>ERB(Embedded Ruby)</td>
<td>erb</td>
</tr>
<tr>
<td>Erlang REPL</td>
<td>erlang-repl</td>
</tr>
<tr>
<td>Erlang</td>
<td>erlang</td>
</tr>
<tr>
<td>FIX</td>
<td>fix</td>
</tr>
<tr>
<td>F#</td>
<td>fsharp</td>
</tr>
<tr>
<td>G-code(ISO 6983)</td>
<td>gcode</td>
</tr>
<tr>
<td>Gherkin</td>
<td>gherkin</td>
</tr>
<tr>
<td>GLSL</td>
<td>glsl</td>
</tr>
<tr>
<td>Go</td>
<td>go</td>
</tr>
<tr>
<td>Gradle</td>
<td>gradle</td>
</tr>
<tr>
<td>Groovy</td>
<td>groovy</td>
</tr>
<tr>
<td>Haml</td>
<td>haml</td>
</tr>
<tr>
<td>Handlebars</td>
<td>handlebars</td>
</tr>
<tr>
<td>Haskell</td>
<td>haskell</td>
</tr>
<tr>
<td>Haxe</td>
<td>haxe</td>
</tr>
<tr>
<td>HTML</td>
<td>html</td>
</tr>
<tr>
<td>HTTP</td>
<td>http</td>
</tr>
<tr>
<td>Ini file</td>
<td>ini</td>
</tr>
<tr>
<td>Java</td>
<td>java</td>
</tr>
<tr>
<td>JavaScript</td>
<td>javascript</td>
</tr>
<tr>
<td>JSON</td>
<td>json</td>
</tr>
<tr>
<td>Lasso</td>
<td>lasso</td>
</tr>
<tr>
<td>Less</td>
<td>less</td>
</tr>
<tr>
<td>Lisp</td>
<td>lisp</td>
</tr>
<tr>
<td>LiveCode</td>
<td>livecodeserver</td>
</tr>
<tr>
<td>LiveScript</td>
<td>livescript</td>
</tr>
<tr>
<td>Lua</td>
<td>lua</td>
</tr>
<tr>
<td>Makefile</td>
<td>makefile</td>
</tr>
<tr>
<td>Markdown</td>
<td>markdown</td>
</tr>
<tr>
<td>Mathematica</td>
<td>mathematica</td>
</tr>
<tr>
<td>Matlab</td>
<td>matlab</td>
</tr>
<tr>
<td>MEL (Maya Embedded Language)</td>
<td>mel</td>
</tr>
<tr>
<td>Mercury</td>
<td>mercury</td>
</tr>
<tr>
<td>Mizar</td>
<td>mizar</td>
</tr>
<tr>
<td>Monkey</td>
<td>monkey</td>
</tr>
<tr>
<td>Nginx</td>
<td>nginx</td>
</tr>
<tr>
<td>Nimrod</td>
<td>nimrod</td>
</tr>
<tr>
<td>Nix</td>
<td>nix</td>
</tr>
<tr>
<td>NSIS</td>
<td>nsis</td>
</tr>
<tr>
<td>Objective C</td>
<td>objectivec</td>
</tr>
<tr>
<td>OCaml</td>
<td>ocaml</td>
</tr>
<tr>
<td>Oxygene</td>
<td>oxygene</td>
</tr>
<tr>
<td>Parser 3</td>
<td>parser3</td>
</tr>
<tr>
<td>Perl</td>
<td>perl</td>
</tr>
<tr>
<td>PHP</td>
<td>php</td>
</tr>
<tr>
<td>PowerShell</td>
<td>powershell</td>
</tr>
<tr>
<td>Processing</td>
<td>processing</td>
</tr>
<tr>
<td>Python’s profiler output</td>
<td>profile</td>
</tr>
<tr>
<td>Protocol Buffers</td>
<td>protobuf</td>
</tr>
<tr>
<td>Puppet</td>
<td>puppet</td>
</tr>
<tr>
<td>Python</td>
<td>python</td>
</tr>
<tr>
<td>Q</td>
<td>q</td>
</tr>
<tr>
<td>R</td>
<td>r</td>
</tr>
<tr>
<td>RenderMan RIB</td>
<td>rib</td>
</tr>
<tr>
<td>Roboconf</td>
<td>roboconf</td>
</tr>
<tr>
<td>RenderMan RSL</td>
<td>rsl</td>
</tr>
<tr>
<td>Ruby</td>
<td>ruby</td>
</tr>
<tr>
<td>Oracle Rules Language</td>
<td>ruleslanguage</td>
</tr>
<tr>
<td>Rust</td>
<td>rust</td>
</tr>
<tr>
<td>Scala</td>
<td>scala</td>
</tr>
<tr>
<td>Scheme</td>
<td>scheme</td>
</tr>
<tr>
<td>Scilab</td>
<td>scilab</td>
</tr>
<tr>
<td>SCSS</td>
<td>scss</td>
</tr>
<tr>
<td>Smali</td>
<td>smali</td>
</tr>
<tr>
<td>SmallTalk</td>
<td>smalltalk</td>
</tr>
<tr>
<td>SML</td>
<td>sml</td>
</tr>
<tr>
<td>SQL</td>
<td>sql</td>
</tr>
<tr>
<td>Stata</td>
<td>stata</td>
</tr>
<tr>
<td>STEP Part21(ISO 10303-21)</td>
<td>step21</td>
</tr>
<tr>
<td>Stylus</td>
<td>stylus</td>
</tr>
<tr>
<td>Swift</td>
<td>swift</td>
</tr>
<tr>
<td>Tcl</td>
<td>tcl</td>
</tr>
<tr>
<td>Tex</td>
<td>tex</td>
</tr>
<tr>
<td>text</td>
<td>text&#x2F;plain</td>
</tr>
<tr>
<td>Thrift</td>
<td>thrift</td>
</tr>
<tr>
<td>Twig</td>
<td>twig</td>
</tr>
<tr>
<td>TypeScript</td>
<td>typescript</td>
</tr>
<tr>
<td>Vala</td>
<td>vala</td>
</tr>
<tr>
<td>VB.NET</td>
<td>vbnet</td>
</tr>
<tr>
<td>VBScript in HTML</td>
<td>vbscript-html</td>
</tr>
<tr>
<td>VBScript</td>
<td>vbscript</td>
</tr>
<tr>
<td>Verilog</td>
<td>verilog</td>
</tr>
<tr>
<td>VHDL</td>
<td>vhdl</td>
</tr>
<tr>
<td>Vim Script</td>
<td>vim</td>
</tr>
<tr>
<td>Intel x86 Assembly</td>
<td>x86asm</td>
</tr>
<tr>
<td>XL</td>
<td>xl</td>
</tr>
<tr>
<td>XML</td>
<td>xml</td>
</tr>
<tr>
<td>YAML</td>
<td>yml</td>
</tr>
</tbody></table>
<h1 id="Bash-login-priority"><a href="#Bash-login-priority" class="headerlink" title="Bash login priority"></a>Bash login priority</h1><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">       -------------/etc/profile----------</span><br><span class="line">       |               |                 |</span><br><span class="line">~/.bash_profile    ~/.bash_login   ~/.profile</span><br><span class="line">       \               |              /</span><br><span class="line">        \              |             / </span><br><span class="line">                   ~/.bashrc</span><br><span class="line">                       |</span><br><span class="line">                       |</span><br><span class="line">                   /etc/bashrc</span><br><span class="line">                       |</span><br><span class="line">                       |</span><br><span class="line">                   ~/.bash_logout </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>&#x2F;etc&#x2F;profile</li>
<li>&#x2F;etc&#x2F;bashrc</li>
<li>~&#x2F;.bashrc</li>
<li>~&#x2F;.bash_profile</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">s =&gt;start: Login</span><br><span class="line">e =&gt;end: Logout</span><br><span class="line">etcPro=&gt;operation: /etc/profile</span><br><span class="line">bashPro=&gt;operation: ~/.bash_profile</span><br><span class="line">bashLogin=&gt;operation: ~/.bash_login</span><br><span class="line">myPro=&gt;operation: ~/.profile</span><br><span class="line">bashRc=&gt;operation: ~/.bashrc</span><br><span class="line">etcRc=&gt;operation: /etc/bashrc</span><br><span class="line">bashOut=&gt;operation: ~/.bash_logout </span><br><span class="line">s--&gt;etcPro--&gt;e</span><br></pre></td></tr></table></figure>

<h2 id="Shell-注释"><a href="#Shell-注释" class="headerlink" title="Shell 注释"></a>Shell 注释</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">: &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">statement1</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>


<h2 id="命令执行顺序"><a href="#命令执行顺序" class="headerlink" title="命令执行顺序"></a>命令执行顺序</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ls -l d.txt &amp;&amp;  echo &quot;File exists.&quot; || echo &quot;File not exists.&quot;</span></span><br><span class="line">-rw-r--r--. 1 root root 0 Jan  1 04:34 d.txt</span><br><span class="line">File exists.</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># ls -l d.txt ||  echo &quot;File exists.&quot; || echo &quot;File not exists.&quot;</span></span><br><span class="line">-rw-r--r--. 1 root root 0 Jan  1 04:34 d.txt</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># ls -l e.txt &amp;&amp;  echo &quot;File exists.&quot; || echo &quot;File not exists.&quot;</span></span><br><span class="line"><span class="built_in">ls</span>: cannot access e.txt: No such file or directory</span><br><span class="line">File not exists.</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># ls -l e.txt &amp;&amp;  echo &quot;File exists.&quot; &amp;&amp; echo &quot;File not exists.&quot;</span></span><br><span class="line"><span class="built_in">ls</span>: cannot access e.txt: No such file or directory</span><br></pre></td></tr></table></figure>

<p><strong>执行多条命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># who ; whoami ; uptime</span></span><br><span class="line">root     pts/1        2024-01-01 04:28 (u33)</span><br><span class="line">root</span><br><span class="line"> 04:56:37 up  2:42,  1 user,  load average: 0.00, 0.01, 0.05</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="计算"><a href="#计算" class="headerlink" title="计算"></a>计算</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># expr 6+6</span></span><br><span class="line">6+6</span><br><span class="line">[root@localhost ~]<span class="comment"># expr 6 + 6</span></span><br><span class="line">12</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># let a=6+6</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $a</span></span><br><span class="line">12</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $[6+6]</span></span><br><span class="line">12</span><br></pre></td></tr></table></figure>

<h3 id="整数运算-let-expr-bc"><a href="#整数运算-let-expr-bc" class="headerlink" title="整数运算 $[] (()) let  expr bc"></a>整数运算 $[] (()) let  expr bc</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo $[1+6]</span></span><br><span class="line">7</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># res1=$[1+6]</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $res1</span></span><br><span class="line">7</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># ((res1=1, res2=res1+6))</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo &quot;$res1, $res2&quot;</span></span><br><span class="line">1, 7</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># let res1=1+7</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $res1</span></span><br><span class="line">8</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># echo &quot;10^2&quot; |bc</span></span><br><span class="line">100</span><br></pre></td></tr></table></figure>

<h2 id="清空文件"><a href="#清空文件" class="headerlink" title="清空文件"></a>清空文件</h2><h3 id="长度为0"><a href="#长度为0" class="headerlink" title="长度为0"></a>长度为0</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># : &gt;d.txt</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ls -l d.txt</span></span><br><span class="line">-rw-r--r--. 1 root root 0 Dec 31 11:32 d.txt</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /dev/null &gt;d.txt</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ls -l d.txt</span></span><br><span class="line">-rw-r--r--. 1 root root 0 Dec 31 11:34 d.txt</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># cp /dev/null d.txt</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># truncate -s 0 d.txt</span></span><br></pre></td></tr></table></figure>

<h3 id="长度为1"><a href="#长度为1" class="headerlink" title="长度为1"></a>长度为1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo &quot;&quot; &gt; d.txt</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ls -l d.txt</span></span><br><span class="line">-rw-r--r--. 1 root root 1 Dec 31 11:35 d.txt</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># expr length “aab”</span></span><br><span class="line">9</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># echo &quot;aab&quot; |wc -L</span></span><br><span class="line">3</span><br><span class="line">[root@localhost ~]<span class="comment"># echo &quot;aab&quot; |wc -c </span></span><br><span class="line">4 (换行)</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># expr &quot;$&#123;str&#125;&quot;</span></span><br><span class="line">abcde</span><br><span class="line">[root@localhost ~]<span class="comment"># expr &quot;$&#123;str&#125;&quot; : &quot;.*&quot;</span></span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<h3 id="截取字符串"><a href="#截取字符串" class="headerlink" title="截取字符串"></a>截取字符串</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># str=&quot;You like Linux so much&quot;</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;str:1&#125;</span></span><br><span class="line">ou like Linux so much</span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;str:2&#125;</span></span><br><span class="line">u like Linux so much</span><br></pre></td></tr></table></figure>
<p>** 截取后面8位或者4位 **</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;str:4:8&#125;</span></span><br><span class="line">like Lin</span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;str:4:4&#125;</span></span><br><span class="line">like</span><br></pre></td></tr></table></figure>
<h3 id="替换字符串"><a href="#替换字符串" class="headerlink" title="替换字符串"></a>替换字符串</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;str/like/love&#125;</span></span><br><span class="line">You love Linux so much</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># expr $a+$b</span></span><br><span class="line">10+20</span><br><span class="line">[root@localhost ~]<span class="comment"># expr $a + $b</span></span><br><span class="line">30</span><br></pre></td></tr></table></figure>

<h3 id="字符数字相加"><a href="#字符数字相加" class="headerlink" title="字符数字相加"></a>字符数字相加</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># let c=a+b</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $c</span></span><br><span class="line">30</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># echo c=$[ $a + $b]</span></span><br><span class="line">c=30</span><br></pre></td></tr></table></figure>
<h1 id="判断条件"><a href="#判断条件" class="headerlink" title="判断条件"></a>判断条件</h1><h2 id="字符串测试"><a href="#字符串测试" class="headerlink" title="字符串测试"></a>字符串测试</h2><ol>
<li>比较操作符两端有空格.</li>
<li>字符串或者变量都要加双引号, 防止字符串内有空格</li>
<li>使用 &gt;&lt;要转义,不然Shell不知道是不是输出重定向.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">|表达式|操作符|说明|</span><br><span class="line">|---|---|---|</span><br><span class="line">|[ <span class="string">&quot;<span class="variable">$&#123;str1&#125;</span>&quot;</span> = <span class="string">&quot;<span class="variable">$&#123;str2&#125;</span>&quot;</span> ] | [] [[]]| 字符串相同时返回真|</span><br><span class="line">| [ <span class="string">&quot;<span class="variable">$&#123;str1&#125;</span>&quot;</span> != <span class="string">&quot;&#123;str2&#125;&quot;</span> ] | [] [[]]| 字符串不相同时返回真|</span><br><span class="line">| [ -n <span class="string">&quot;<span class="variable">$&#123;str1&#125;</span>&quot;</span> ] | [] [[]] | 长度大于0时, 返回真, 非空|</span><br><span class="line">| [ -z <span class="string">&quot;<span class="variable">$&#123;str1&#125;</span>&quot;</span> ] |[] [[]] | 长度等于0时, 返回真, 空串|</span><br><span class="line">|[ <span class="string">&quot;<span class="variable">$&#123;str1&#125;</span> ]| [] [[]] | 非空为真 |</span></span><br><span class="line"><span class="string">|&gt;, &lt;| [] 比较结果一样返回相同值 | [[]] 根据相应ASCII比较 |</span></span><br><span class="line"><span class="string">|\\&gt;, \\&lt;| [] 根据相应ASCII比较| [[]] 不可以使用</span></span><br></pre></td></tr></table></figure>

<h2 id="整数测试"><a href="#整数测试" class="headerlink" title="整数测试"></a>整数测试</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1. <span class="built_in">test</span> <span class="string">&quot;<span class="variable">$num1</span>&quot;</span> op num2</span><br><span class="line">2. [ <span class="string">&quot;<span class="variable">$&#123;num1&#125;</span>&quot;</span> op <span class="string">&quot;<span class="variable">$&#123;num2&#125;</span>&quot;</span> ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">|整数比较运行符 |说明 |</span><br><span class="line">|---|---|</span><br><span class="line">| num1 -eq num2 | 相等为0 |</span><br><span class="line">| num1 -ne num2| 不相等为0 |</span><br><span class="line">| num1 -gt num2| 大于为0 |</span><br><span class="line">| num1 -lt num2| 小于为0 |</span><br><span class="line">| num1 -ge num2| 大于等于为0 |</span><br><span class="line">| num1 -le num2| 小于等于为0 |</span><br><span class="line">| &gt; | 大于, 需要使用双圆括号且要转义, 如((&quot;<span class="variable">$num1</span>&quot; &lt; &quot;<span class="variable">$num2</span>&quot;)) &lt;br&gt;[root@localhost ~]<span class="comment">#  ((1 \&lt; 2)); echo $?&lt;br&gt;0|</span></span><br><span class="line">| &lt; | 小于, 需要使用双圆括号且要转义, 如((&quot;<span class="variable">$num1</span>&quot;&lt;&quot;<span class="variable">$num2</span>&quot;))|</span><br><span class="line">| &gt;= | 大于等于, 需要使用双圆括号且要转义, 如((&quot;<span class="variable">$num1</span>&quot;&gt;=&quot;<span class="variable">$num2</span>&quot;))|</span><br><span class="line">| &lt;=| 小于等于, 需要使用双圆括号且要转义, 如((&quot;<span class="variable">$num1</span>&quot;&lt;=&quot;<span class="variable">$num2</span>&quot;))|</span><br></pre></td></tr></table></figure>


<h2 id="文件状态测试"><a href="#文件状态测试" class="headerlink" title="文件状态测试"></a>文件状态测试</h2><table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-a file</td>
<td>如果文件存在为真</td>
</tr>
<tr>
<td>-b file</td>
<td>如果文件是块设备为真</td>
</tr>
<tr>
<td>-c file</td>
<td>如果文件字符设备为真</td>
</tr>
<tr>
<td>-d file</td>
<td>如果是目录为真</td>
</tr>
<tr>
<td>-f file</td>
<td>如果是普能文件为真, 非目录和设备文件</td>
</tr>
<tr>
<td>-g file</td>
<td>如果文件设置了SGID位为真</td>
</tr>
<tr>
<td>-L file</td>
<td>如果是符号链接为真</td>
</tr>
<tr>
<td>-u file</td>
<td>如果文件设置了SUID为真</td>
</tr>
<tr>
<td>-r file</td>
<td>如果文件可读为真</td>
</tr>
<tr>
<td>-w file</td>
<td>如果文件可写为真</td>
</tr>
<tr>
<td>-x file</td>
<td>如果文件可执行为真</td>
</tr>
<tr>
<td>-s file</td>
<td>如果文件为空为真, 文件大小大于0</td>
</tr>
<tr>
<td>-c file</td>
<td>如果文件或目录存在为真</td>
</tr>
</tbody></table>
<h2 id="复杂判断逻辑运算符"><a href="#复杂判断逻辑运算符" class="headerlink" title="复杂判断逻辑运算符"></a>复杂判断逻辑运算符</h2><table>
<thead>
<tr>
<th>逻辑运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-a</td>
<td>逻辑与</td>
</tr>
<tr>
<td>-o</td>
<td>逻辑或</td>
</tr>
<tr>
<td>!</td>
<td>逻辑非</td>
</tr>
</tbody></table>
<h2 id="子shell"><a href="#子shell" class="headerlink" title="子shell"></a>子shell</h2><p>(cmd1;cmd2): 子shell<br>{cmd1; cmd2}: 当前shell</p>
<p>在第一个例子中，使用小括号创建了一个子shell，子shell 中修改的变量 a 不会影响到父shell，因此在最后的 echo $a 中输出的是父shell 中的值，即 6。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># a=6</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ( echo &quot;Hello&quot; ; a=7; echo $a;);echo $a</span></span><br><span class="line">Hello</span><br><span class="line">7</span><br><span class="line">6</span><br></pre></td></tr></table></figure>


<p>在第二个例子中，使用大括号块 {} 创建的是当前shell 的命令组合，其中对变量 a 的修改会影响到父shell。因此，在最后的 echo $a 中输出的是被修改过的值，即 7。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># a=6</span></span><br><span class="line">[root@localhost ~]<span class="comment"># &#123; echo &quot;Hello&quot; ; a=7; echo $a;&#125;;echo $a</span></span><br><span class="line">Hello</span><br><span class="line">7</span><br><span class="line">7</span><br></pre></td></tr></table></figure>

<h2 id="Test-let"><a href="#Test-let" class="headerlink" title="Test [] [[]] (()) let"></a>Test [] [[]] (()) let</h2><ul>
<li>[] 等同test, 用于传统的测试表达式，如字符串比较、整数比较等。</li>
<li>[] 在进行字符串比较时，通常需要使用 &#x3D; 或者 !&#x3D;，而在 [[ … ]] 中可以使用 &#x3D;&#x3D; 或者 !&#x3D;。</li>
<li>[[ … ]] 更灵活，可以进行正则表达式匹配，如 [[ “$var” &#x3D;~ pattern ]]。</li>
<li>[[ … ]] 中的变量不需要引号引起来，而在 [] 中最好使用引号。</li>
<li>(())用于算术操作，可以进行整数比较和赋值等</li>
<li>let用于执行算术操作和赋值。</li>
</ul>
<h3 id="反引号-："><a href="#反引号-：" class="headerlink" title="反引号 &#96;&#96;："></a>反引号 &#96;&#96;：</h3><p>result&#x3D;<code>command</code><br>或者</p>
<p>result&#x3D;$(command)<br>这两种语法是等效的，它们都会执行 command 并将其输出赋值给变量 result。这种方式在较旧版本的shell中较为常见。</p>
<h3 id="："><a href="#：" class="headerlink" title="$()："></a>$()：</h3><p>result&#x3D;$(command)<br>这是一种更现代、推荐使用的命令替换方式，与反引号 &#96;&#96; 功能相同。这个语法更灵活，并且可以嵌套使用，而且在可读性上更好。</p>
<h3 id="eval："><a href="#eval：" class="headerlink" title="eval："></a>eval：</h3><p>eval result&#x3D;$(command)<br>eval 用于执行字符串中的命令。它会将参数合并成一个字符串，并将其作为 shell 命令执行。eval 可以用于动态地构建和执行命令，但也容易引入安全性问题，因为它会执行任意的 shell 代码。</p>
<p>总的来说，推荐使用 $() 进行命令替换，因为它更灵活、可读性更好，并且在大多数情况下更安全。 eval 的使用应当谨慎，因为它可能导致意外的副作用和安全风险。</p>
<h3 id="字符子串Index"><a href="#字符子串Index" class="headerlink" title="字符子串Index"></a>字符子串Index</h3><p>[root@localhost ~]# expr index ${str} ‘a’<br>2</p>
<p>[root@localhost ~]# echo $str |awk -F “” ‘{print $1, $NF}’<br>h i</p>
<p>[root@localhost ~]# echo “This is a test” |awk ‘{printf(“%d\n”, match($0, “test”))}’<br>11</p>
<h3 id="双引号-单引号-VAR-单引号-双引号"><a href="#双引号-单引号-VAR-单引号-双引号" class="headerlink" title="双引号 + 单引号 + VAR +  单引号 + 双引号"></a>双引号 + 单引号 + VAR +  单引号 + 双引号</h3><p>[root@localhost ~]# awk ‘BEGIN{print “‘$a’”}’<br>aaa</p>
<h3 id="双引号-单引号-双引号-VAR-双引号-单引号-双引号-如果变量中有空格，防止将空格作为分隔符"><a href="#双引号-单引号-双引号-VAR-双引号-单引号-双引号-如果变量中有空格，防止将空格作为分隔符" class="headerlink" title="双引号 + 单引号 + 双引号 + VAR +  双引号 + 单引号 + 双引号, 如果变量中有空格，防止将空格作为分隔符"></a>双引号 + 单引号 + 双引号 + VAR +  双引号 + 单引号 + 双引号, 如果变量中有空格，防止将空格作为分隔符</h3><p>[root@localhost ~]# awk ‘BEGIN{print “‘“$a”‘“}’<br>aaa</p>
<h3 id="AWK向Shell传递变量"><a href="#AWK向Shell传递变量" class="headerlink" title="AWK向Shell传递变量"></a>AWK向Shell传递变量</h3><p>[root@localhost ~]# eval $(awk ‘BEGIN{print “var1&#x3D;’str1’”}’)<br>[root@localhost ~]# echo $var1<br>str1</p>
<h3 id="输出OFS"><a href="#输出OFS" class="headerlink" title="输出OFS"></a>输出OFS</h3><p>[root@localhost ~]# awk -F: ‘{if ($1&#x3D;&#x3D;”root”) print $1,$3}’ OFS&#x3D;’&amp;&amp;&amp;’  &#x2F;etc&#x2F;passwd<br>root&amp;&amp;&amp;0</p>
<p>Print all: print 或 print $0<br>[root@localhost ~]# awk -F: ‘{if ($1&#x3D;&#x3D;”root”) print}’ &#x2F;etc&#x2F;passwd<br>root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</p>
<h3 id="自定义标题"><a href="#自定义标题" class="headerlink" title="自定义标题"></a>自定义标题</h3><p>[root@localhost ~]# awk ‘BEGIN{OFS&#x3D;”\t”; print “UserName”,”Privilegs”} {print $1, $3} END{print “All users”}’ FS&#x3D;”:” &#x2F;etc&#x2F;passwd<br>UserName        Privilegs<br>root    0<br>bin     1<br>daemon  2<br>adm     3<br>tcpdump 72<br>All users</p>
<h3 id="自定义标题格式左对齐"><a href="#自定义标题格式左对齐" class="headerlink" title="自定义标题格式左对齐"></a>自定义标题格式左对齐</h3><p>[root@localhost ~]# awk ‘BEGIN{OFS&#x3D;”\t”; printf “%-20s%s\n”, “UserName”, “Privileges”} {printf “%-20s%s\n”, $1, $3} END{print “All users”}’ FS&#x3D;”:” &#x2F;etc&#x2F;passwd<br>UserName            Privileges<br>root                0<br>bin                 1<br>daemon              2<br>adm                 3<br>lp                  4<br>sync                5<br>shutdown            6<br>tcpdump             72<br>All users<br>[root@localhost ~]# awk ‘BEGIN{OFS&#x3D;”\t”; printf “%-20s%-20s\n”, “UserName”, “Privileges”} {printf “%-20s%-20s\n”, $1, $3} END{print “All users”}’ FS&#x3D;”:” &#x2F;etc&#x2F;passwd<br>UserName            Privileges<br>root                0<br>bin                 1<br>daemon              2<br>adm                 3<br>lp                  4</p>
<h3 id="右对齐"><a href="#右对齐" class="headerlink" title="右对齐"></a>右对齐</h3><p>[root@localhost ~]# awk ‘BEGIN{OFS&#x3D;”\t”; printf “%+20s%+20s\n”, “UserName”, “Privileges”} {printf “%+20s%+20s\n”, $1, $3} END{print “All users”}’ FS&#x3D;”:” &#x2F;etc&#x2F;passwd<br>            UserName          Privileges<br>                root                   0<br>                 bin                   1<br>              daemon                   2<br>                 adm                   3<br>                  lp                   4<br>                sync                   5</p>
<h3 id="多分隔符使用-F’-’"><a href="#多分隔符使用-F’-’" class="headerlink" title="多分隔符使用 -F’[]’"></a>多分隔符使用 -F’[]’</h3><p>[root@localhost ~]# cat c.txt<br>aa_bb:cc_dd:ee_ff<br>hh_ii:jj_kk:ll_mm<br>[root@localhost ~]# awk -F’[: _]’ ‘{print $1, $6}’ c.txt<br>aa ff<br>hh mm</p>
<h3 id="使用-F’-’-解决连续分隔符"><a href="#使用-F’-’-解决连续分隔符" class="headerlink" title="使用 -F’[]’+ 解决连续分隔符"></a>使用 -F’[]’+ 解决连续分隔符</h3><p>[root@localhost ~]# cat c.txt<br>aa__bb:::cc__dd:::::ee__ff<br>hh__ii:::jj__kk:::::ll__mm<br>[root@localhost ~]# awk -F’[: _]+’ ‘{print $1, $6}’ c.txt<br>aa ff<br>hh mm</p>
<p>[root@localhost ~]# awk ‘BEGIN{a&#x3D;”aaa”; print a++, ++a}’<br>0 2<br>这是因为在 awk 中，字符串和数字之间的操作会进行自动的类型转换。在这个例子中，a 被初始化为字符串 “aaa”，然后在 print 语句中使用了自增运算符 ++，这导致 awk 将字符串 “aaa” 转换为数字。字符串 “aaa” 被解释为数字 0，因为它以一个非数字字符开头。</p>
<p>所以，a++ 中的 ++ 会使 a 的值变为 0，而 ++a 会使 a 的值变为 1。因此，结果是 “0 2”。</p>
<p>如果你想要避免这种自动转换，你可以将 a 明确初始化为数字，例如：awk ‘BEGIN{a&#x3D;0; print a++, ++a}’</p>
<h3 id="模式匹配-awk-pattern-actioins"><a href="#模式匹配-awk-pattern-actioins" class="headerlink" title="模式匹配 awk pattern { actioins }"></a>模式匹配 awk pattern { actioins }</h3><p>[root@localhost ~]# awk -F: ‘&#x2F;^(r..t|adm)&#x2F;{print $1}’ &#x2F;etc&#x2F;passwd<br>root<br>adm</p>
<p>[root@localhost ~]# awk -F: ‘$3&gt;990  {print $1}’ &#x2F;etc&#x2F;passwd<br>polkitd<br>libstoragemgmt<br>unbound<br>gluster<br>nfsnobody<br>pcp<br>chrony</p>
<p>[root@localhost ~]# awk -F: ‘{IGNORECASE&#x3D;1; if($1 ~&#x2F;^[a-z]&#x2F; &amp;&amp;  $NF ~&#x2F;bash$&#x2F;) {print $0}}’ &#x2F;etc&#x2F;passwd<br>root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</p>
<p>[root@localhost ~]# awk -F: ‘{ if (!($1 ~&#x2F;^[a-z]&#x2F; &amp;&amp; $NF ~&#x2F;bash$&#x2F;)) {print} }’ &#x2F;etc&#x2F;passwd<br>bin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin<br>daemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin<br>adm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</p>
<p>[root@localhost ~]# awk -F: ‘$3&gt;990 &amp;&amp; $4&#x3D;995  {print}’ &#x2F;etc&#x2F;passwd<br>polkitd x 999 995 User for polkitd &#x2F; &#x2F;sbin&#x2F;nologin<br>libstoragemgmt x 998 995 daemon account for libstoragemgmt &#x2F;var&#x2F;run&#x2F;lsm &#x2F;sbin&#x2F;nologin<br>unbound x 997 995 Unbound DNS resolver &#x2F;etc&#x2F;unbound &#x2F;sbin&#x2F;nologin<br>gluster x 996 995 GlusterFS daemons &#x2F;run&#x2F;gluster &#x2F;sbin&#x2F;nologin<br>nfsnobody x 65534 995 Anonymous NFS User &#x2F;var&#x2F;lib&#x2F;nfs &#x2F;sbin&#x2F;nologin<br>pcp x 995 995 Performance Co-Pilot &#x2F;var&#x2F;lib&#x2F;pcp &#x2F;sbin&#x2F;nologin<br>chrony x 994 995  &#x2F;var&#x2F;lib&#x2F;chrony &#x2F;sbin&#x2F;nologin</p>
<h3 id="自定义变量"><a href="#自定义变量" class="headerlink" title="自定义变量"></a>自定义变量</h3><p>[root@localhost ~]#  awk -v name&#x3D;aaa ‘BEGIN{printf “my name is %-20s\n”, name}’<br>my name is aaa<br>[root@localhost ~]#  awk -v name&#x3D;aaa ‘BEGIN{printf “my name is %+20s\n”, name}’<br>my name is                  aaa</p>
<p>For each<br>[root@localhost ~]# awk -F: ‘{a[NR]&#x3D;$1} END{for (item in a) print a[item]}’ &#x2F;etc&#x2F;passwd<br>mysql<br>libstoragemgmt<br>adm<br>pcp<br>rpc<br>lp<br>sshd</p>
<p>For loop<br>[root@localhost ~]# awk -F: ‘{a[NR]&#x3D;$1} END{for (i&#x3D;1; i&lt;&#x3D;NR; i++) print a[i]}’ &#x2F;etc&#x2F;passwd<br>root<br>bin<br>daemon<br>adm<br>lp</p>
<h3 id="内置变量与Export变量"><a href="#内置变量与Export变量" class="headerlink" title="内置变量与Export变量"></a>内置变量与Export变量</h3><p>[root@localhost ~]# export a&#x3D;aaa<br>[root@localhost ~]# awk ‘BEGIN{for (i in ENVIRON) {print i”&#x3D;”ENVIRON[i]}}’<br>AWKPATH&#x3D;.:&#x2F;usr&#x2F;share&#x2F;awk<br>SELINUX_LEVEL_REQUESTED&#x3D;<br>SELINUX_ROLE_REQUESTED&#x3D;<br>LANG&#x3D;en_US.UTF-8<br>HISTSIZE&#x3D;1000<br>XDG_RUNTIME_DIR&#x3D;&#x2F;run&#x2F;user&#x2F;0<br>USER&#x3D;root<br>_&#x3D;&#x2F;usr&#x2F;bin&#x2F;awk<br>SELINUX_USE_CURRENT_RANGE&#x3D;<br>TERM&#x3D;xterm<br>SHELL&#x3D;&#x2F;bin&#x2F;bash<br>a&#x3D;aaa</p>
<h3 id="AWK的运行时间"><a href="#AWK的运行时间" class="headerlink" title="AWK的运行时间"></a>AWK的运行时间</h3><p>[root@localhost ~]# time(awk ‘BEGIN{total&#x3D;0; for (i&#x3D;0;i&lt;&#x3D;10000;i++) {total+&#x3D;i;} print total;}’)<br>50005000</p>
<p>real    0m0.003s<br>user    0m0.000s<br>sys     0m0.003s</p>
<p>[root@localhost ~]# time(total&#x3D;0;for i in $(seq 10000);do total&#x3D;$(($total + i ));done; echo $total;)<br>50005000</p>
<p>real    0m0.071s<br>user    0m0.065s<br>sys     0m0.005s</p>
<h3 id="变量相加"><a href="#变量相加" class="headerlink" title="变量相加"></a>变量相加</h3><p>[root@localhost ~]# awk ‘BEGIN{a&#x3D;10;b&#x3D;20;c&#x3D;(a+b);print c}’<br>30</p>
<h3 id="字符连接"><a href="#字符连接" class="headerlink" title="字符连接"></a>字符连接</h3><p>[root@localhost ~]# awk ‘BEGIN{a&#x3D;10;b&#x3D;20;c&#x3D;(a””b);print c}’<br>1020</p>
<h3 id="统计并排序"><a href="#统计并排序" class="headerlink" title="统计并排序"></a>统计并排序</h3><ul>
<li><input checked="" disabled="" type="checkbox"> 方法一<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># awk &#x27;&#123;a[$1]++&#125; END&#123; for ( b in a ) print a[b], b&#125;&#x27; a.txt|sort -rn</span></span><br><span class="line">3 ccc</span><br><span class="line">2 aaa</span><br><span class="line">1 bbb</span><br></pre></td></tr></table></figure></li>
<li><input checked="" disabled="" type="checkbox"> 方法二<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># sort a.txt |uniq -c |sort -rn</span></span><br><span class="line">      3 ccc</span><br><span class="line">      2 aaa</span><br><span class="line">      1 bbb</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="grep-空行"><a href="#grep-空行" class="headerlink" title="grep 空行"></a>grep 空行</h3><p>[root@localhost ~]# grep “^$” *</p>
<h3 id="rep-空行和注释行"><a href="#rep-空行和注释行" class="headerlink" title="rep 空行和注释行"></a>rep 空行和注释行</h3><p>[root@localhost ~]# grep -E “^$|#” *</p>
<h2 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h2><p>[root@localhost ~]# sed ‘s&#x2F;ccc&#x2F;eee&#x2F;‘ a.txt<br>aaa<br>bbb<br>eee ccc<br>aaa<br>eee ccc<br>eee ccc</p>
<p>[root@localhost ~]# sed ‘s&#x2F;ccc&#x2F;eee&#x2F;g’ a.txt<br>aaa<br>bbb<br>eee eee<br>aaa<br>eee eee<br>eee eee</p>
<p>[root@localhost ~]# sed -i ‘s&#x2F;ccc&#x2F;eee&#x2F;g’ a.txt<br>[root@localhost ~]# cat a.txt<br>aaa<br>bbb<br>eee eee<br>aaa<br>eee eee<br>eee eee</p>
<h3 id="插入到行前"><a href="#插入到行前" class="headerlink" title="插入到行前"></a>插入到行前</h3><p>[root@localhost ~]#  sed -e ‘&#x2F;bbb&#x2F;i\fff’ a.txt<br>aaa<br>fff<br>bbb<br>eee eee<br>aaa<br>eee eee<br>eee eee</p>
<h3 id="插入到行后"><a href="#插入到行后" class="headerlink" title="插入到行后"></a>插入到行后</h3><p>[root@localhost ~]#  sed -e ‘&#x2F;bbb&#x2F;a\fff’ a.txt<br>aaa<br>bbb<br>fff<br>eee eee<br>aaa<br>eee eee<br>eee eee</p>
<h3 id="删除第2行，-最后一行"><a href="#删除第2行，-最后一行" class="headerlink" title="删除第2行， 最后一行"></a>删除第2行， 最后一行</h3><p>[root@localhost ~]# sed ‘2d;$d’ a.txt<br>aaa<br>fff<br>eee eee<br>aaa<br>eee eee</p>
<h3 id="删除第2到最后一行"><a href="#删除第2到最后一行" class="headerlink" title="删除第2到最后一行"></a>删除第2到最后一行</h3><p>[root@localhost ~]# sed ‘2,$d’ a.txt<br>aaa</p>
<h3 id="删除奇数行"><a href="#删除奇数行" class="headerlink" title="删除奇数行"></a>删除奇数行</h3><p>[root@localhost <del>]# sed ‘1</del>2d’ a.txt<br>bbb<br>eee eee<br>eee eee</p>
<h3 id="行前行后-增加"><a href="#行前行后-增加" class="headerlink" title="行前行后 增加"></a>行前行后 增加</h3><p>[root@localhost ~]# sed ‘3a hhh’ a.txt<br>aaa<br>bbb<br>fff<br>hhh<br>eee eee<br>aaa<br>eee eee<br>eee eee<br>[root@localhost ~]# sed ‘3i hhh’ a.txt<br>aaa<br>bbb<br>hhh<br>fff<br>eee eee<br>aaa<br>eee eee<br>eee eee</p>
<h2 id="dd"><a href="#dd" class="headerlink" title="dd"></a>dd</h2><blockquote>
<p>dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;.&#x2F;test.txt bs&#x3D;1M count&#x3D;10</p>
</blockquote>
<h2 id="find-and-execute-command"><a href="#find-and-execute-command" class="headerlink" title="find and execute command"></a>find and execute command</h2><p> [root@localhost ~]# find a.txt -exec ls -l {} ;<br>-rw-r–r–. 1 root root 40 Jan  7 08:54 a.txt</p>
<p>[root@localhost ~]# find a* -type f -exec ls -l {} ;<br>-rw——-. 1 root root 1861 Nov 15 09:04 anaconda-ks.cfg<br>-rw-r–r–. 1 root root 35 Dec 11 10:37 a.sh<br>-rw-r–r–. 1 root root 40 Jan  7 08:54 a.txt</p>
<h3 id="if-statement"><a href="#if-statement" class="headerlink" title="if statement"></a>if statement</h3><p>if [ condition1 ]<br>then<br>    statements<br>elif [ condition2 ]<br>then<br>    statements<br>else<br>    statements<br>fi</p>
<h3 id="case-statement"><a href="#case-statement" class="headerlink" title="case statement"></a>case statement</h3><p>case $1 in<br>  value1)<br>    statements<br>    break<br>;;<br>  value2)<br>    statements<br>    break<br>;;<br>  *)<br>    statements<br>;;<br>esac</p>
<h3 id="for-statement"><a href="#for-statement" class="headerlink" title="for statement"></a>for statement</h3><p>for arg in “$@”<br>do<br>    echo $arg<br>done</p>
<p>for arg<br>do<br>    echo $arg<br>done</p>
<p>for file in $(ls)<br>for num in 1 2 3 4 5<br>for ((i&#x3D;1; i&lt;&#x3D;5; i++))<br>for var in {1..5}<br>for var in {1..100..2}<br>do<br> statements<br>done</p>
<h3 id="while-条件为真-条件退出状态为0"><a href="#while-条件为真-条件退出状态为0" class="headerlink" title="while 条件为真, 条件退出状态为0"></a>while 条件为真, 条件退出状态为0</h3><p>i&#x3D;1<br>while ((i &lt;&#x3D; 6 ))<br>do<br>    echo $i<br>    let “i++”<br>done</p>
<h3 id="until-条件为假时执行循环"><a href="#until-条件为假时执行循环" class="headerlink" title="until 条件为假时执行循环"></a>until 条件为假时执行循环</h3><p>until who |grep “root” &amp;&gt; &#x2F;dev&#x2F;null<br>do<br> echo “$(date) root not login”<br> sleep 3<br>done</p>
<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># select color in &quot;red&quot; &quot;blue&quot; &quot;green&quot;</span></span><br><span class="line">&gt; <span class="keyword">do</span></span><br><span class="line">&gt; <span class="built_in">break</span></span><br><span class="line">&gt; <span class="keyword">done</span></span><br><span class="line">1) red</span><br><span class="line">2) blue</span><br><span class="line">3) green</span><br><span class="line"><span class="comment">#? 2</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $color</span></span><br><span class="line">blue</span><br></pre></td></tr></table></figure>

<p>不带参数, 直接从命令行取$* 或$@</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bash a.sh red bule green</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Please select you color:&quot;</span></span><br><span class="line"><span class="keyword">select</span> color</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">break</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;You color is <span class="variable">$color</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><h3 id="定义数组"><a href="#定义数组" class="headerlink" title="定义数组"></a>定义数组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># arr1=(&quot;a&quot; &quot;b&quot; &quot;c&quot;)</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;arr1[0]&#125;</span></span><br><span class="line">a</span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;arr1[1]&#125;</span></span><br><span class="line">b</span><br></pre></td></tr></table></figure>

<h4 id="declare"><a href="#declare" class="headerlink" title="declare"></a>declare</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># declare -a arr2</span></span><br><span class="line">[root@localhost ~]<span class="comment"># arr2[1]=&quot;aa&quot;</span></span><br><span class="line">[root@localhost ~]<span class="comment"># arr2[2]=&quot;bb&quot;</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;arr2&#125;</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;arr2[@]&#125;</span></span><br><span class="line">aa bb</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="指定键值"><a href="#指定键值" class="headerlink" title="指定键值"></a>指定键值</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># arr3=([0]=&quot;aaa&quot; [2]=&quot;bbb&quot;)</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;arr3[2]&#125;</span></span><br><span class="line">bbb</span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;arr3[1]&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="关联数组"><a href="#关联数组" class="headerlink" title="关联数组"></a>关联数组</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr4=([age]=18 [sex]=<span class="string">&quot;girl&quot;</span> [class]=<span class="string">&quot;2008&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;arr4[age]&#125;</span>    <span class="comment"># Should output: 18</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;arr4[class]&#125;</span>  <span class="comment"># Should output: 2008</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;arr4[sex]&#125;</span>    <span class="comment"># Should output: girl</span></span><br></pre></td></tr></table></figure>

<h3 id="数组长度"><a href="#数组长度" class="headerlink" title="数组长度"></a>数组长度</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示全部元素</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;arr3[@]&#125;</span></span><br><span class="line">aaa bbb</span><br><span class="line"><span class="comment">#数组名代名第一个元素</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;arr3&#125;</span></span><br><span class="line">aaa</span><br><span class="line"><span class="comment">#全部元素个数</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;#arr3[@]&#125;</span></span><br><span class="line">2</span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;#arr3[*]&#125;</span></span><br><span class="line">2</span><br><span class="line"><span class="comment">#某个元素的长度</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;#arr3[2]&#125;</span></span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<h3 id="数组遍历"><a href="#数组遍历" class="headerlink" title="数组遍历"></a>数组遍历</h3><p>for i in “${array[@]}”</p>
<h3 id="数组切片"><a href="#数组切片" class="headerlink" title="数组切片"></a>数组切片</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#元素从0开始, </span></span><br><span class="line">[root@localhost ~]<span class="comment"># arr3=([0]=&quot;aaa&quot; [1]=&quot;bbb&quot; [2]=&quot;ccc&quot; [3]=&quot;ddd&quot; [4]=&quot;eee&quot;)</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo &quot;$&#123;arr3[@]:1:1&#125;&quot;</span></span><br><span class="line">bbb</span><br><span class="line">[root@localhost ~]<span class="comment"># echo &quot;$&#123;arr3[@]:1:2&#125;&quot;</span></span><br><span class="line">bbb ccc</span><br><span class="line">[root@localhost ~]<span class="comment"># echo &quot;$&#123;arr3[@]:2:4&#125;&quot;</span></span><br><span class="line">ccc ddd eee</span><br></pre></td></tr></table></figure>
<h3 id="数组替换-复制-删除"><a href="#数组替换-复制-删除" class="headerlink" title="数组替换, 复制, 删除"></a>数组替换, 复制, 删除</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># arr3=([0]=&quot;aaa&quot; [1]=&quot;bbb&quot; [2]=&quot;ccc&quot; [3]=&quot;ddd&quot; [4]=&quot;eee&quot;)</span></span><br><span class="line"><span class="comment">#元素替换</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo &quot;$&#123;arr3[@]/ccc/hhh&#125;&quot;</span></span><br><span class="line">aaa bbb hhh ddd eee</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除数组, unset 不能用$array, 这样没有效果, 如下</span></span><br><span class="line">[root@localhost ~]<span class="comment"># unset $&#123;arr3[2]&#125;</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo &quot;$&#123;arr3[@]&#125;&quot;</span></span><br><span class="line">aaa bbb ccc ddd eee</span><br><span class="line">[root@localhost ~]<span class="comment"># unset $arr3</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo &quot;$&#123;arr3[@]&#125;&quot;</span></span><br><span class="line">aaa bbb ccc ddd eee</span><br><span class="line"><span class="comment">#删除一个元素</span></span><br><span class="line">[root@localhost ~]<span class="comment"># unset arr3[2]</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo &quot;$&#123;arr3[@]&#125;&quot;</span></span><br><span class="line">aaa bbb ddd ee</span><br><span class="line"><span class="comment">#删除全部</span></span><br><span class="line">[root@localhost ~]<span class="comment"># unset arr3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#复制数组</span></span><br><span class="line">[root@localhost ~]<span class="comment"># arr3=([0]=&quot;aaa&quot; [1]=&quot;bbb&quot; [2]=&quot;ccc&quot; [3]=&quot;ddd&quot; [4]=&quot;eee&quot;)</span></span><br><span class="line">[root@localhost ~]<span class="comment"># arr4=(&quot;$&#123;arr3[@]&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;arr4[@]&#125;</span></span><br><span class="line">aaa bbb ccc ddd eee</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># unset arr4[2]</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;arr4[@]&#125;</span></span><br><span class="line">aaa bbb ddd eee</span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;arr3[@]&#125;</span></span><br><span class="line">aaa bbb ccc ddd eee</span><br><span class="line"></span><br><span class="line"><span class="comment">#连接数组</span></span><br><span class="line">[root@localhost ~]<span class="comment"># c=(&quot;$&#123;arr3[@]&#125;&quot; &quot;$&#123;arr4[@]&#125;&quot;)</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $&#123;c[@]&#125;</span></span><br><span class="line">aaa bbb ccc ddd eee aaa bbb ddd eee</span><br><span class="line"></span><br><span class="line"><span class="comment">#将文本内容加载到数组</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cat &gt;aaaa.txt &lt;&lt;name</span></span><br><span class="line">aaa</span><br><span class="line">bb</span><br><span class="line">cc</span><br><span class="line"><span class="built_in">dd</span></span><br><span class="line">eee</span><br><span class="line">name</span><br><span class="line"></span><br><span class="line">items=$(<span class="built_in">cat</span> aaaa.txt)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;items[@]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;i&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><ol>
<li>函数名和 { 之间必须有空格</li>
<li>不得声明形式参数</li>
<li>必须在调用前声明</li>
<li>无法重载</li>
<li>后面的声明会覆盖之前的</li>
<li>return 0-255</li>
<li>$# 参数个数, 没有是0</li>
<li>$@,$* 所有参数</li>
<li>$0 函数名</li>
<li>$1开始, 具体参数值</li>
<li>函数内部变量与全局变量重名, 使用local关键字</li>
<li>可以定义函数在~&#x2F;.bash_profile 或 ~&#x2F;.bashrc,不用时可以unset, 使用时当作命令用</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">test</span></span>() </span><br><span class="line">&#123;</span><br><span class="line">    a=<span class="string">&quot;hello world! <span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;a=<span class="variable">$&#123;a&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res=$(<span class="built_in">test</span> <span class="string">&quot;nihao&quot;</span>)</span><br><span class="line"></span><br><span class="line">the result is a=hello world! nihao</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># tail -5 .bashrc</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">hi</span></span>()</span><br><span class="line">&#123;</span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;Hello world!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># . .bashrc</span></span><br><span class="line">[root@localhost ~]<span class="comment"># hi</span></span><br><span class="line">Hello world!</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/02/21/Linux-shell-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="cltr83b4d0001g1o60s1k9mxf" data-title="Linux-shell-学习笔记" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li></ul>

    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9D%91/" rel="tag">坑</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9D%91-Jenkins/" rel="tag">坑 Jenkins</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Jenkins/" style="font-size: 10px;">Jenkins</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/k8s/" style="font-size: 10px;">k8s</a> <a href="/tags/%E5%9D%91/" style="font-size: 20px;">坑</a> <a href="/tags/%E5%9D%91-Jenkins/" style="font-size: 10px;">坑 Jenkins</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/11/17/Jenkins-%E8%AE%BE%E7%BD%AEGit%E5%87%AD%E6%8D%AE%E7%9A%84%E9%97%AE%E9%A2%98/">Jenkins 设置Git凭据的问题</a>
          </li>
        
          <li>
            <a href="/2024/11/16/%E8%BF%81%E7%A7%BBDocker-image-%E5%AD%98%E5%82%A8/">迁移Docker image 存储</a>
          </li>
        
          <li>
            <a href="/2024/11/16/Jenkins-share-library-%E6%8E%A2%E5%9D%91/">Jenkins share library 探坑</a>
          </li>
        
          <li>
            <a href="/2024/03/23/20240323-k8s-notes-md/">k8s 学习笔记</a>
          </li>
        
          <li>
            <a href="/2024/03/19/20240319-hexo-disply-image-md/">解决Hexo 显示图片的问题</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>